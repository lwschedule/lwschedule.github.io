<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LW Schedule</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300;400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --purple: #4b2e83;
      --purple-light: #6a4fb3;
      --text-light: #e8e8e8;
      --bg-dark: #1a1a1a;
      --card-dark: #262626;
      --glow: 0 0 12px rgba(107, 76, 183, 0.8);
    }

    * {
      font-family: 'Comfortaa', cursive;
    }

    body {
      background: var(--bg-dark);
      color: var(--text-light);
      margin: 0;
      padding: 20px;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    body::-webkit-scrollbar {
      display: none;
    }

    h1 {
      text-align: center;
      color: var(--purple-light);
      font-weight: 700;
    }

    #digitalClock {
      font-size: 5em;
      font-weight: 700;
      text-align: center;
      color: var(--purple-light);
      background: var(--card-dark);
      padding: 30px;
      border-radius: 16px;
      box-shadow: var(--glow);
      max-width: 650px;
      margin: 20px auto;
      letter-spacing: 0.05em;
    }

    #clockLabel {
      font-size: 0.3em;
      margin-bottom: 10px;
      color: var(--text-light);
      opacity: 0.8;
      font-weight: 400;
    }

    #timer {
      font-size: 1.1em;
      margin-top: 20px;
      text-align: center;
      background: var(--card-dark);
      padding: 15px;
      border-radius: 16px;
      box-shadow: var(--glow);
      max-width: 650px;
      margin: 20px auto;
    }

    #timer.hidden {
      display: none;
    }

    select {
      background: var(--card-dark);
      color: var(--text-light);
      padding: 8px 14px;
      border-radius: 12px;
      border: 1px solid var(--purple-light);
      box-shadow: var(--glow);
      font-size: 1em;
      cursor: pointer;
    }

    .mainButtons {
      display: flex;
      gap: 15px;
      justify-content: center;
      max-width: 650px;
      margin: 30px auto;
      flex-wrap: wrap;
    }

    .mainBtn {
      flex: 1;
      min-width: 200px;
      background: var(--purple-light);
      color: white;
      border: none;
      padding: 15px 30px;
      font-size: 1.1em;
      border-radius: 12px;
      cursor: pointer;
      box-shadow: var(--glow);
      transition: all 0.3s;
      font-weight: 700;
    }

    .mainBtn:hover {
      background: var(--purple);
      transform: scale(1.05);
    }

    .lunchButtons {
      display: flex;
      gap: 10px;
      justify-content: center;
    }

    .lunchBtn {
      flex: 1;
      background: var(--card-dark);
      color: var(--text-light);
      border: 2px solid var(--purple-light);
      padding: 12px 24px;
      font-size: 1em;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 700;
    }

    .lunchBtn:hover {
      background: var(--purple-light);
      color: white;
      transform: scale(1.05);
    }

    .lunchBtn.selected {
      background: var(--purple-light);
      color: white;
      box-shadow: var(--glow);
    }

    .lunchBtn:disabled {
      opacity: 1;
      cursor: default;
    }

    .continueBtn {
      display: block;
      width: 100%;
      background: var(--purple-light);
      color: white;
      border: none;
      padding: 15px 40px;
      font-size: 1.1em;
      border-radius: 12px;
      cursor: pointer;
      box-shadow: var(--glow);
      transition: all 0.3s;
      font-weight: 700;
      margin-top: 20px;
    }

    .continueBtn:hover {
      background: var(--purple);
      transform: scale(1.05);
    }

    #settingsBtn {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--purple-light);
      color: white;
      border: none;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      font-size: 1.5em;
      cursor: pointer;
      box-shadow: var(--glow);
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #settingsBtn:hover {
      background: var(--purple);
      transform: rotate(90deg);
    }

    #scheduleOverlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(5px);
    }

    #scheduleOverlay.active, #holidaysOverlay.active, #settingsOverlay.active, #welcomeOverlay.active {
      display: flex;
    }

    #holidaysOverlay, #settingsOverlay, #welcomeOverlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(5px);
    }

    #scheduleModal {
      background: var(--card-dark);
      padding: 30px;
      border-radius: 16px;
      box-shadow: var(--glow);
      max-width: 650px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    #scheduleModal::-webkit-scrollbar {
      display: none;
    }

    #closeBtn {
      position: absolute;
      top: 15px;
      right: 15px;
      background: var(--purple-light);
      color: white;
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      font-size: 1.5em;
      cursor: pointer;
      line-height: 1;
      transition: all 0.3s;
    }

    #closeBtn:hover {
      background: var(--purple);
      transform: rotate(90deg);
    }

    #schedule {
      margin-top: 20px;
    }

    .scheduleTable {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      background: #1f1f1f;
      border-radius: 12px;
      overflow: hidden;
    }

    .scheduleTable th {
      background: var(--purple-light);
      color: white;
      padding: 12px;
      text-align: left;
      font-weight: 700;
    }

    .scheduleTable td {
      padding: 12px;
      border-bottom: 1px solid #444;
    }

    .scheduleTable tr:last-child td {
      border-bottom: none;
    }

    .scheduleTable tr.highlight {
      background: var(--purple-light);
      color: white;
      font-weight: 700;
    }

    .scheduleTable tr:not(.highlight):hover {
      background: #2a2a2a;
    }

    .holidayTable {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      background: #1f1f1f;
      border-radius: 12px;
      overflow: hidden;
    }

    .holidayTable th {
      background: var(--purple-light);
      color: white;
      padding: 12px;
      text-align: left;
      font-weight: 700;
    }

    .holidayTable td {
      padding: 12px;
      border-bottom: 1px solid #444;
    }

    .holidayTable tr:last-child td {
      border-bottom: none;
    }

    .holidayTable tr:hover {
      background: #2a2a2a;
    }

    #scheduleModal h2 {
      margin-top: 0;
      color: var(--purple-light);
      text-align: center;
      font-weight: 700;
    }

    #holidayCountdown {
      font-size: clamp(2em, 8vw, 5em);
      font-weight: 700;
      text-align: center;
      color: var(--purple-light);
      background: var(--card-dark);
      padding: 30px;
      border-radius: 16px;
      box-shadow: var(--glow);
      margin: 20px 0;
      letter-spacing: 0.05em;
    }

    #holidayCountdownLabel {
      font-size: 0.3em;
      margin-bottom: 10px;
      color: var(--text-light);
      opacity: 0.8;
      font-weight: 400;
    }

    #holidayCountdownTime {
      font-size: 1em;
    }

    .settingsRow {
      padding: 15px;
      margin: 10px 0;
      background: #1f1f1f;
      border-radius: 12px;
    }

    .settingsRow label {
      display: block;
      margin-bottom: 8px;
      font-weight: 700;
    }

    .dayLabel {
      font-size: 0.9em;
      color: var(--text-light);
      opacity: 0.8;
      margin-bottom: 5px;
    }

    .notSetLabel {
      text-align: center;
      color: var(--text-light);
      opacity: 0.6;
      font-style: italic;
      padding: 10px;
    }
  </style>
</head>
<body>
  <h1>LW Schedule</h1>

  <button id="settingsBtn" onclick="toggleSettings()">⚙️</button>

  <div id="digitalClock">
    <div id="clockLabel">TIME REMAINING</div>
    <div id="clockDisplay">--:--:--</div>
  </div>

  <div id="timer"></div>

  <div class="mainButtons">
    <button class="mainBtn" onclick="toggleSchedule()">View Full Schedule</button>
    <button class="mainBtn" onclick="toggleHolidays()">Upcoming Holidays</button>
  </div>

  <div id="scheduleOverlay" onclick="closeOverlay(event)">
    <div id="scheduleModal">
      <button id="closeBtn" onclick="toggleSchedule()">×</button>
      <h2>Today's Schedule</h2>
      <div id="schedule"></div>
    </div>
  </div>

  <div id="holidaysOverlay" onclick="closeHolidaysOverlay(event)">
    <div id="scheduleModal">
      <button id="closeBtn" onclick="toggleHolidays()">×</button>
      <h2>Upcoming Holidays 2025-26</h2>
      <div id="holidayCountdown">
        <div id="holidayCountdownLabel">NEXT HOLIDAY</div>
        <div id="holidayCountdownTime">--d --h --m --s</div>
      </div>
      <div id="holidays">
        <table class="holidayTable">
          <thead>
            <tr>
              <th>Holiday</th>
              <th>Date</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><b>Labor Day</b></td>
              <td>September 1, 2025</td>
            </tr>
            <tr>
              <td><b>LEAP Day</b></td>
              <td>October 17, 2025</td>
            </tr>
            <tr>
              <td><b>LEAP Day</b></td>
              <td>November 4, 2025</td>
            </tr>
            <tr>
              <td><b>Veterans Day</b></td>
              <td>November 11, 2025</td>
            </tr>
            <tr>
              <td><b>Thanksgiving Break</b></td>
              <td>November 27-28, 2025</td>
            </tr>
            <tr>
              <td><b>Winter Break</b></td>
              <td>December 22-26, 29-31, 2025 & January 1-2, 2026</td>
            </tr>
            <tr>
              <td><b>MLK Jr. Day</b></td>
              <td>January 19, 2026</td>
            </tr>
            <tr>
              <td><b>Mid-Winter Break</b></td>
              <td>February 12-13, 2026</td>
            </tr>
            <tr>
              <td><b>Presidents Day</b></td>
              <td>February 16, 2026</td>
            </tr>
            <tr>
              <td><b>LEAP Day</b></td>
              <td>March 13, 2026</td>
            </tr>
            <tr>
              <td><b>Spring Break</b></td>
              <td>April 13-17, 2026</td>
            </tr>
            <tr>
              <td><b>LEAP Day</b></td>
              <td>May 22, 2026</td>
            </tr>
            <tr>
              <td><b>Memorial Day</b></td>
              <td>May 25, 2026</td>
            </tr>
            <tr>
              <td><b>Last Day of School</b></td>
              <td>June 17, 2026</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div id="settingsOverlay" onclick="closeSettingsOverlay(event)">
    <div id="scheduleModal">
      <button id="closeBtn" onclick="toggleSettings()">×</button>
      <h2>Settings</h2>
      <div class="settingsRow">
        <label>Monday Lunch:</label>
        <div class="lunchButtons" id="mondayButtons">
          <button class="lunchBtn" id="mondayA" onclick="selectDayLunch('Monday', 'A')">A Lunch</button>
          <button class="lunchBtn" id="mondayB" onclick="selectDayLunch('Monday', 'B')">B Lunch</button>
        </div>
        <div class="notSetLabel" id="mondayNotSet" style="display:none;">Lunch not selected yet</div>
      </div>
      <div class="settingsRow">
        <label>Tuesday Lunch:</label>
        <div class="lunchButtons" id="tuesdayButtons">
          <button class="lunchBtn" id="tuesdayA" onclick="selectDayLunch('Tuesday', 'A')">A Lunch</button>
          <button class="lunchBtn" id="tuesdayB" onclick="selectDayLunch('Tuesday', 'B')">B Lunch</button>
        </div>
        <div class="notSetLabel" id="tuesdayNotSet" style="display:none;">Lunch not selected yet</div>
      </div>
      <div class="settingsRow">
        <label>Wednesday Lunch:</label>
        <div class="lunchButtons">
          <button class="lunchBtn selected" disabled>All School Lunch</button>
        </div>
      </div>
      <div class="settingsRow">
        <label>Thursday Lunch:</label>
        <div class="lunchButtons" id="thursdayButtons">
          <button class="lunchBtn" id="thursdayA" onclick="selectDayLunch('Thursday', 'A')">A Lunch</button>
          <button class="lunchBtn" id="thursdayB" onclick="selectDayLunch('Thursday', 'B')">B Lunch</button>
        </div>
        <div class="notSetLabel" id="thursdayNotSet" style="display:none;">Lunch not selected yet</div>
      </div>
      <div class="settingsRow">
        <label>Friday Lunch:</label>
        <div class="lunchButtons" id="fridayButtons">
          <button class="lunchBtn" id="fridayA" onclick="selectDayLunch('Friday', 'A')">A Lunch</button>
          <button class="lunchBtn" id="fridayB" onclick="selectDayLunch('Friday', 'B')">B Lunch</button>
        </div>
        <div class="notSetLabel" id="fridayNotSet" style="display:none;">Lunch not selected yet</div>
      </div>
    </div>
  </div>

  <div id="welcomeOverlay">
    <div id="scheduleModal">
      <h2>Select Your Lunch</h2>
      <div class="dayLabel" id="welcomeDayLabel"></div>
      <div class="settingsRow">
        <label id="welcomeLabel">Please select your lunch:</label>
        <div class="lunchButtons">
          <button class="lunchBtn" id="welcomeA" onclick="selectWelcomeLunch('A')">A Lunch</button>
          <button class="lunchBtn" id="welcomeB" onclick="selectWelcomeLunch('B')">B Lunch</button>
        </div>
      </div>
      <button class="continueBtn" onclick="saveWelcomeLunch()">Continue</button>
    </div>
  </div>

  <script>
    // Save lunch choices per day
    let lunchPreferences = {
      Monday: null,
      Tuesday: null,
      Wednesday: 'All',
      Thursday: null,
      Friday: null
    };
    let selectedWelcomeLunch = 'A';
    
    async function loadLunchPreferences() {
      try {
        const result = await window.storage.get('lunch-preferences');
        if (result && result.value) {
          lunchPreferences = JSON.parse(result.value);
        }
      } catch (error) {
        console.log('No saved preferences, using defaults');
      }
      
      // Update settings buttons
      updateSettingsButtons();
    }

    function updateSettingsButtons() {
      const days = ['Monday', 'Tuesday', 'Thursday', 'Friday'];
      
      days.forEach(day => {
        const dayLower = day.toLowerCase();
        const hasSelection = lunchPreferences[day] !== null;
        
        // Always show buttons, hide "not set" label when there's a selection
        document.getElementById(`${dayLower}Buttons`).style.display = 'flex';
        document.getElementById(`${dayLower}NotSet`).style.display = hasSelection ? 'none' : 'block';
        
        // Update button selection state
        document.getElementById(`${dayLower}A`).classList.toggle('selected', lunchPreferences[day] === 'A');
        document.getElementById(`${dayLower}B`).classList.toggle('selected', lunchPreferences[day] === 'B');
      });
    }

    function selectWelcomeLunch(lunch) {
      selectedWelcomeLunch = lunch;
      document.getElementById('welcomeA').classList.toggle('selected', lunch === 'A');
      document.getElementById('welcomeB').classList.toggle('selected', lunch === 'B');
    }

    function selectDayLunch(day, lunch) {
      lunchPreferences[day] = lunch;
      updateSettingsButtons();
      saveDayLunch(day);
    }
    
    async function saveDayLunch(day) {
      try {
        await window.storage.set('lunch-preferences', JSON.stringify(lunchPreferences));
        await window.storage.set(`lunch-set-${day}`, new Date().toDateString());
      } catch (error) {
        console.error('Failed to save lunch preference:', error);
      }
      render();
    }

    async function saveWelcomeLunch() {
      const today = dayName();
      if (today === 'Wednesday') {
        lunchPreferences[today] = 'All';
      } else {
        lunchPreferences[today] = selectedWelcomeLunch;
      }
      
      try {
        await window.storage.set('lunch-preferences', JSON.stringify(lunchPreferences));
        await window.storage.set(`lunch-set-${today}`, new Date().toDateString());
      } catch (error) {
        console.error('Failed to save lunch preference:', error);
      }
      
      updateSettingsButtons();
      document.getElementById('welcomeOverlay').classList.remove('active');
      render();
    }

    async function checkIfNeedsLunchSelection() {
      const today = dayName();
      
      // Wednesday always has all-school lunch, no need to ask
      if (today === 'Wednesday') {
        return false;
      }
      
      // Check if not a school day
      if (!today || today === 'Saturday' || today === 'Sunday') {
        return false;
      }
      
      try {
        const result = await window.storage.get(`lunch-set-${today}`);
        const todayDate = new Date().toDateString();
        
        // If lunch is null or not set for today, show popup
        if (lunchPreferences[today] === null || !result || result.value !== todayDate) {
          // Haven't set lunch for today yet
          document.getElementById('welcomeDayLabel').innerHTML = `Today is ${today}`;
          document.getElementById('welcomeLabel').innerHTML = `Select your lunch for ${today}:`;
          selectedWelcomeLunch = lunchPreferences[today] || 'A';
          document.getElementById('welcomeA').classList.toggle('selected', selectedWelcomeLunch === 'A');
          document.getElementById('welcomeB').classList.toggle('selected', selectedWelcomeLunch === 'B');
          document.getElementById('welcomeOverlay').classList.add('active');
          return true;
        }
      } catch (error) {
        // No record exists, show welcome
        document.getElementById('welcomeDayLabel').innerHTML = `Today is ${today}`;
        document.getElementById('welcomeLabel').innerHTML = `Select your lunch for ${today}:`;
        selectedWelcomeLunch = lunchPreferences[today] || 'A';
        document.getElementById('welcomeA').classList.toggle('selected', selectedWelcomeLunch === 'A');
        document.getElementById('welcomeB').classList.toggle('selected', selectedWelcomeLunch === 'B');
        document.getElementById('welcomeOverlay').classList.add('active');
        return true;
      }
      
      return false;
    }

    // Initialize app
    async function initApp() {
      await loadLunchPreferences();
      const needsLunch = await checkIfNeedsLunchSelection();
      if (!needsLunch) {
        render();
      }
      setInterval(render, 1000);
      setInterval(updateHolidayCountdown, 1000);
    }

    initApp();

    function toggleSchedule() {
      const overlay = document.getElementById('scheduleOverlay');
      overlay.classList.toggle('active');
    }

    function toggleHolidays() {
      const overlay = document.getElementById('holidaysOverlay');
      overlay.classList.toggle('active');
      if (overlay.classList.contains('active')) {
        updateHolidayCountdown();
      }
    }

    function toggleSettings() {
      const overlay = document.getElementById('settingsOverlay');
      overlay.classList.toggle('active');
    }

    function closeOverlay(event) {
      if (event.target === document.getElementById('scheduleOverlay')) {
        toggleSchedule();
      }
    }

    function closeHolidaysOverlay(event) {
      if (event.target === document.getElementById('holidaysOverlay')) {
        toggleHolidays();
      }
    }

    function closeSettingsOverlay(event) {
      if (event.target === document.getElementById('settingsOverlay')) {
        toggleSettings();
      }
    }

    // Check if current date is Veterans Day week (Nov 10-14, 2025)
    function isVeteransWeek() {
      const now = new Date();
      const year = now.getFullYear();
      const month = now.getMonth();
      const date = now.getDate();
      
      // November 2025, dates 10-14
      return year === 2025 && month === 10 && date >= 10 && date <= 14;
    }

    // Check if current date is Thanksgiving week (Nov 24-28, 2025)
    function isThanksgivingWeek() {
      const now = new Date();
      const year = now.getFullYear();
      const month = now.getMonth();
      const date = now.getDate();
      
      // November 2025, dates 24-28
      return year === 2025 && month === 10 && date >= 24 && date <= 28;
    }

    // Check if current date is MLK Jr. Day / Finals week (Jan 19-23, 2026)
    function isFinalsWeek() {
      const now = new Date();
      const year = now.getFullYear();
      const month = now.getMonth();
      const date = now.getDate();
      
      // January 2026, dates 19-23
      return year === 2026 && month === 0 && date >= 19 && date <= 23;
    }

    // Bell schedule (simplified times in minutes after midnight)
    function getSchedules() {
      const today = dayName();
      const lunch = lunchPreferences[today] || 'A';
      
      // Finals week special schedule (Jan 19-23, 2026)
      if (isFinalsWeek()) {
        return {
          Monday: [], // No school - MLK Jr. Day
          Tuesday: [
            { name:"Planning & Preparation", start: 7*60+30, end: 8*60+35 },
            { name:"Period 1", start: 8*60+35, end: 9*60+20 },
            { name:"Period 2", start: 9*60+30, end: 10*60+50 },
            ...(lunch === 'A' ? [
              { name:"A Lunch", start: 10*60+50, end: 11*60+20 },
              { name:"Period 4", start: 11*60+30, end: 12*60+50 }
            ] : [
              { name:"Period 4", start: 11*60, end: 12*60+20 },
              { name:"B Lunch", start: 12*60+20, end: 12*60+50 }
            ]),
            { name:"Period 4", start: 13*60, end: 13*60+45 },
            { name:"Period 6", start: 13*60+55, end: 15*60+15 },
            { name:"Planning & Preparation", start: 15*60+15, end: 15*60+30 }
          ],
          Wednesday: [
            { name:"Planning & Preparation", start: 7*60+30, end: 8*60+35 },
            { name:"Period 1", start: 8*60+35, end: 9*60+55 },
            { name:"Period 3", start: 10*60+5, end: 11*60+25 },
            { name:"Period 5", start: 11*60+35, end: 12*60+55 },
            { name:"Lunch", start: 13*60, end: 13*60+30 },
            { name:"LEAP", start: 13*60+30, end: 15*60+15 },
            { name:"Planning & Preparation", start: 15*60+15, end: 15*60+30 }
          ],
          Thursday: [
            { name:"Planning & Preparation", start: 7*60+30, end: 8*60+35 },
            { name:"Period 2", start: 8*60+35, end: 9*60+55 },
            { name:"Period 3", start: 10*60+5, end: 10*60+50 },
            ...(lunch === 'A' ? [
              { name:"A Lunch", start: 10*60+50, end: 11*60+20 },
              { name:"Period 4", start: 11*60+30, end: 12*60+50 }
            ] : [
              { name:"Period 4", start: 11*60, end: 12*60+20 },
              { name:"B Lunch", start: 12*60+20, end: 12*60+50 }
            ]),
            { name:"Period 5", start: 13*60, end: 13*60+45 },
            { name:"Period 6", start: 13*60+55, end: 15*60+15 },
            { name:"Planning & Preparation", start: 15*60+15, end: 15*60+30 }
          ],
          Friday: [
            { name:"Planning & Preparation", start: 7*60+30, end: 8*60+35 },
            { name:"Period 1", start: 8*60+35, end: 9*60+55 },
            { name:"Period 2", start: 10*60+5, end: 10*60+50 },
            ...(lunch === 'A' ? [
              { name:"A Lunch", start: 10*60+50, end: 11*60+20 },
              { name:"Period 3", start: 11*60+30, end: 12*60+50 }
            ] : [
              { name:"Period 3", start: 11*60, end: 12*60+20 },
              { name:"B Lunch", start: 12*60+20, end: 12*60+50 }
            ]),
            { name:"Period 5", start: 13*60, end: 14*60+20 },
            { name:"Period 6", start: 14*60+30, end: 15*60+15 },
            { name:"Planning & Preparation", start: 15*60+15, end: 15*60+30 }
          ]
        };
      }
      
      // Thanksgiving week special schedule (Nov 24-28, 2025)
      if (isThanksgivingWeek()) {
        return {
          Monday: [
            { name:"Planning & Preparation", start: 7*60+30, end: 8*60+35 },
            { name:"Period 1", start: 8*60+35, end: 9*60+30 },
            { name:"Period 2", start: 9*60+38, end: 10*60+33 },
            { name:"Period 3", start: 10*60+41, end: 11*60+36 },
            ...(lunch === 'A' ? [
              { name:"A Lunch", start: 11*60+36, end: 12*60+6 },
              { name:"Period 4", start: 12*60+14, end: 13*60+9 }
            ] : [
              { name:"Period 4", start: 11*60+44, end: 12*60+39 },
              { name:"B Lunch", start: 12*60+39, end: 13*60+9 }
            ]),
            { name:"Period 5", start: 13*60+17, end: 14*60+12 },
            { name:"Period 6", start: 14*60+20, end: 15*60+15 },
            { name:"Planning & Preparation", start: 15*60+15, end: 15*60+30 }
          ],
          Tuesday: [
            { name:"Planning & Preparation", start: 7*60+30, end: 8*60+35 },
            { name:"Period 1", start: 8*60+35, end: 9*60+23 },
            { name:"Homeroom/Personalization", start: 9*60+30, end: 10*60+10 },
            { name:"Period 2", start: 10*60+17, end: 11*60+5 },
            ...(lunch === 'A' ? [
              { name:"A Lunch", start: 11*60+5, end: 11*60+35 },
              { name:"Period 3", start: 11*60+42, end: 12*60+30 }
            ] : [
              { name:"Period 3", start: 11*60+12, end: 12*60 },
              { name:"B Lunch", start: 12*60, end: 12*60+30 }
            ]),
            { name:"Period 4", start: 12*60+37, end: 13*60+25 },
            { name:"Period 5", start: 13*60+32, end: 14*60+20 },
            { name:"Period 6", start: 14*60+27, end: 15*60+15 },
            { name:"Planning & Preparation", start: 15*60+15, end: 15*60+30 }
          ],
          Wednesday: [
            { name:"Planning & Preparation", start: 7*60+30, end: 8*60+35 },
            { name:"Period 1", start: 8*60+35, end: 9*60 },
            { name:"Period 2", start: 9*60+7, end: 9*60+32 },
            { name:"Period 3", start: 9*60+39, end: 10*60+4 },
            { name:"Period 4", start: 10*60+11, end: 10*60+36 },
            { name:"Period 5", start: 10*60+43, end: 11*60+8 },
            { name:"Period 6", start: 11*60+15, end: 11*60+40 },
            { name:"Breakfast Served - No Lunch", start: 11*60+40, end: 11*60+40 }
          ],
          Thursday: [], // No school - Thanksgiving Break
          Friday: [] // No school - Thanksgiving Break
        };
      }
      
      // Veterans Day week special schedule (Nov 10-14, 2025)
      if (isVeteransWeek()) {
        return {
          Monday: [
            { name:"Planning & Preparation", start: 7*60+30, end: 8*60+35 },
            { name:"Period 1", start: 8*60+35, end: 9*60+30 },
            { name:"Period 2", start: 9*60+38, end: 10*60+33 },
            { name:"Period 3", start: 10*60+41, end: 11*60+36 },
            ...(lunch === 'A' ? [
              { name:"A Lunch", start: 11*60+36, end: 12*60+6 },
              { name:"Period 4", start: 12*60+14, end: 13*60+9 }
            ] : [
              { name:"Period 4", start: 11*60+44, end: 12*60+39 },
              { name:"B Lunch", start: 12*60+39, end: 13*60+9 }
            ]),
            { name:"Period 5", start: 13*60+17, end: 14*60+12 },
            { name:"Period 6", start: 14*60+20, end: 15*60+15 },
            { name:"Planning & Preparation", start: 15*60+15, end: 15*60+30 }
          ],
          Tuesday: [], // No school - Veterans Day
          Wednesday: [
            { name:"Planning & Preparation", start: 7*60+30, end: 8*60+35 },
            { name:"Period 1", start: 8*60+35, end: 9*60+12 },
            { name:"Period 2", start: 9*60+19, end: 9*60+56 },
            { name:"Period 3", start: 10*60+3, end: 10*60+40 },
            { name:"Period 4", start: 10*60+47, end: 11*60+24 },
            { name:"Period 5", start: 11*60+31, end: 12*60+8 },
            { name:"Period 6", start: 12*60+15, end: 12*60+52 },
            { name:"Lunch", start: 12*60+52, end: 13*60+30 },
            { name:"LEAP", start: 13*60+30, end: 15*60+15 },
            { name:"Planning & Preparation", start: 15*60+15, end: 15*60+30 }
          ],
          Thursday: [
            { name:"Planning & Preparation", start: 7*60+30, end: 8*60+35 },
            { name:"Period 1", start: 8*60+35, end: 9*60+30 },
            { name:"Period 2", start: 9*60+38, end: 10*60+33 },
            { name:"Period 3", start: 10*60+41, end: 11*60+36 },
            ...(lunch === 'A' ? [
              { name:"A Lunch", start: 11*60+36, end: 12*60+6 },
              { name:"Period 4", start: 12*60+14, end: 13*60+9 }
            ] : [
              { name:"Period 4", start: 11*60+44, end: 12*60+39 },
              { name:"B Lunch", start: 12*60+39, end: 13*60+9 }
            ]),
            { name:"Period 5", start: 13*60+17, end: 14*60+12 },
            { name:"Period 6", start: 14*60+20, end: 15*60+15 },
            { name:"Planning & Preparation", start: 15*60+15, end: 15*60+30 }
          ],
          Friday: [
            { name:"Planning & Preparation", start: 7*60+30, end: 8*60+35 },
            { name:"Period 1", start: 8*60+35, end: 9*60+23 },
            { name:"Homeroom/Personalization", start: 9*60+30, end: 10*60+10 },
            { name:"Period 2", start: 10*60+17, end: 11*60+5 },
            ...(lunch === 'A' ? [
              { name:"A Lunch", start: 11*60+5, end: 11*60+35 },
              { name:"Period 3", start: 11*60+42, end: 12*60+30 }
            ] : [
              { name:"Period 3", start: 11*60+12, end: 12*60 },
              { name:"B Lunch", start: 12*60, end: 12*60+30 }
            ]),
            { name:"Period 4", start: 12*60+37, end: 13*60+25 },
            { name:"Period 5", start: 13*60+32, end: 14*60+20 },
            { name:"Period 6", start: 14*60+27, end: 15*60+15 },
            { name:"Planning & Preparation", start: 15*60+15, end: 15*60+30 }
          ]
        };
      }
      
      // Regular schedule
      return {
        Monday: [
          { name:"Period 1", start: 8*60+35, end: 9*60+55 },
          { name:"Period 2", start: 10*60+5, end: 10*60+50 },
          ...(lunch === 'A' ? [
            { name:"A Lunch", start: 10*60+50, end: 11*60+20 },
            { name:"Period 3", start: 11*60+30, end: 12*60+50 }
          ] : [
            { name:"Period 3", start: 11*60, end: 12*60+20 },
            { name:"B Lunch", start: 12*60+20, end: 12*60+50 }
          ]),
          { name:"Period 5", start: 13*60, end: 14*60+20 },
          { name:"Period 6", start: 14*60+30, end: 15*60+15 }
        ],
        Tuesday: [
          { name:"Period 1", start: 8*60+35, end: 9*60+20 },
          { name:"Period 2", start: 9*60+30, end: 10*60+50 },
          ...(lunch === 'A' ? [
            { name:"A Lunch", start: 10*60+50, end: 11*60+20 },
            { name:"Period 4", start: 11*60+30, end: 12*60+50 }
          ] : [
            { name:"Period 4", start: 11*60, end: 12*60+20 },
            { name:"B Lunch", start: 12*60+20, end: 12*60+50 }
          ]),
          { name:"Period 6", start: 13*60+55, end: 15*60+15 }
        ],
        Wednesday: [
          { name:"Period 1", start: 8*60+35, end: 9*60+55 },
          { name:"Period 3", start: 10*60+5, end: 11*60+25 },
          { name:"Lunch", start: 13*60, end: 13*60+30 },
          { name:"LEAP", start: 13*60+30, end: 15*60+15 }
        ],
        Thursday: [
          { name:"Period 2", start: 8*60+35, end: 9*60+55 },
          { name:"Period 3", start: 10*60+5, end: 10*60+50 },
          ...(lunch === 'A' ? [
            { name:"A Lunch", start: 10*60+50, end: 11*60+20 },
            { name:"Period 4", start: 11*60+30, end: 12*60+50 }
          ] : [
            { name:"Period 4", start: 11*60, end: 12*60+20 },
            { name:"B Lunch", start: 12*60+20, end: 12*60+50 }
          ]),
          { name:"Period 6", start: 13*60+55, end: 15*60+15 }
        ],
        Friday: [
          { name:"Period 1", start: 8*60+35, end: 9*60+23 },
          { name:"Homeroom", start: 9*60+30, end: 10*60+10 },
          { name:"Period 2", start: 10*60+17, end: 11*60+5 },
          ...(lunch === 'A' ? [
            { name:"A Lunch", start: 11*60+5, end: 11*60+35 },
            { name:"Period 3", start: 11*60+42, end: 12*60 }
          ] : [
            { name:"Period 3", start: 11*60+42, end: 12*60 },
            { name:"B Lunch", start: 12*60, end: 12*60+30 }
          ]),
          { name:"Period 4", start: 12*60+37, end: 13*60+25 },
          { name:"Period 5", start: 13*60+32, end: 14*60+20 },
          { name:"Period 6", start: 14*60+27, end: 15*60+15 }
        ]
      };
    }

    function dayName() {
      return new Date().toLocaleDateString('en-US', { weekday: 'long' });
    }

    function minutesNow() {
      const d = new Date();
      return d.getHours()*60 + d.getMinutes();
    }

    function secondsNow() {
      return new Date().getSeconds();
    }

    function format(m) {
      const h = Math.floor(m/60);
      const mm = m%60;
      return `${h}:${mm.toString().padStart(2,'0')}`;
    }

    function formatTime(minutes, seconds) {
      const h = Math.floor(minutes/60);
      const m = minutes%60;
      const s = seconds;
      return `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
    }

    // Holiday countdown
    const holidays = [
      { name: "Labor Day", date: new Date(2025, 8, 1) },
      { name: "LEAP Day", date: new Date(2025, 9, 17) },
      { name: "LEAP Day", date: new Date(2025, 10, 4) },
      { name: "Veterans Day", date: new Date(2025, 10, 11) },
      { name: "Thanksgiving Break", date: new Date(2025, 10, 27) },
      { name: "Winter Break", date: new Date(2025, 11, 22) },
      { name: "MLK Jr. Day", date: new Date(2026, 0, 19) },
      { name: "Mid-Winter Break", date: new Date(2026, 1, 12) },
      { name: "Presidents Day", date: new Date(2026, 1, 16) },
      { name: "LEAP Day", date: new Date(2026, 2, 13) },
      { name: "Spring Break", date: new Date(2026, 3, 13) },
      { name: "LEAP Day", date: new Date(2026, 4, 22) },
      { name: "Memorial Day", date: new Date(2026, 4, 25) },
      { name: "Last Day of School", date: new Date(2026, 5, 17) }
    ];

    function updateHolidayCountdown() {
      const now = new Date();
      const upcoming = holidays.find(h => h.date > now);
      
      if (upcoming) {
        const diff = upcoming.date - now;
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((diff % (1000 * 60)) / 1000);
        
        document.getElementById('holidayCountdownLabel').innerHTML = `NEXT HOLIDAY - ${upcoming.name}`;
        document.getElementById('holidayCountdownTime').innerHTML = 
          `${days}d ${hours.toString().padStart(2,'0')}h ${minutes.toString().padStart(2,'0')}m ${seconds.toString().padStart(2,'0')}s`;
      } else {
        document.getElementById('holidayCountdownLabel').innerHTML = 'NO UPCOMING HOLIDAYS';
        document.getElementById('holidayCountdownTime').innerHTML = 'End of school year';
      }
    }

    function render() {
      const schedules = getSchedules();
      const today = schedules[dayName()];
      if (!today) {
        document.getElementById('clockDisplay').innerHTML = "--:--:--";
        document.getElementById('clockLabel').innerHTML = "NO SCHOOL TODAY";
        document.getElementById('timer').innerHTML = "Enjoy your day off!";
        document.getElementById('timer').classList.remove('hidden');
        return;
      }

      const now = minutesNow();
      const secs = secondsNow();
      let html = "<table class='scheduleTable'><thead><tr><th>Period</th><th>Start</th><th>End</th></tr></thead><tbody>";
      let current = null;
      let next = null;
      let inPassingPeriod = false;

      // Check if we're in a period
      for (let i=0; i<today.length; i++) {
        const p = today[i];
        const active = now >= p.start && now < p.end;
        if (active) {
          current = p;
          next = today[i+1] || null;
        }
        html += `<tr class='${active?"highlight":""}'>
          <td>${p.name}</td>
          <td>${format(p.start)}</td>
          <td>${format(p.end)}</td>
        </tr>`;
      }

      html += "</tbody></table>";

      // If not in a period, check if we're in a passing period
      if (!current) {
        for (let i=0; i<today.length-1; i++) {
          if (now >= today[i].end && now < today[i+1].start) {
            inPassingPeriod = true;
            current = { name: "Passing Period", start: today[i].end, end: today[i+1].start };
            next = today[i+1];
            break;
          }
        }
      }

      document.getElementById('schedule').innerHTML = html;

      if (current) {
        const remainingMinutes = current.end - now - 1;
        const remainingSeconds = 60 - secs;
        
        document.getElementById('clockDisplay').innerHTML = formatTime(remainingMinutes, remainingSeconds);
        document.getElementById('clockLabel').innerHTML = `TIME REMAINING - ${current.name}`;
        
        const nextName = next ? `${next.name}<br>${format(next.start)} - ${format(next.end)}` : "School Day Complete";
        document.getElementById('timer').innerHTML =
          `Current: <b>${current.name}</b><br>Next: ${nextName}`;
        document.getElementById('timer').classList.remove('hidden');
      } else {
        document.getElementById('clockDisplay').innerHTML = "--:--:--";
        document.getElementById('clockLabel').innerHTML = "NO PERIOD SCHEDULED";
        document.getElementById('timer').classList.add('hidden');
      }
    }

  </script>
</body>
</html>
