<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LW Schedule</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300;400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #4b2e83;
      --primary-light: #6a4fb3;
      --text-light: #e8e8e8;
      --bg-dark: #1a1a1a;
      --card-dark: #262626;
      --glow: 0 0 12px rgba(107, 76, 183, 0.8);
    }

    /* Theme classes */
    body.theme-purple {
      --primary: #4b2e83;
      --primary-light: #6a4fb3;
      --glow: 0 0 12px rgba(107, 76, 183, 0.8);
      --text-on-primary: white;
    }
    body.theme-red {
      --primary: #c41e3a;
      --primary-light: #e63946;
      --glow: 0 0 12px rgba(230, 57, 70, 0.8);
      --text-on-primary: white;
    }
    body.theme-orange {
      --primary: #d35400;
      --primary-light: #e67e22;
      --glow: 0 0 12px rgba(230, 126, 34, 0.8);
      --text-on-primary: white;
    }
    body.theme-yellow {
      --primary: #c29d00;
      --primary-light: #f1c40f;
      --glow: 0 0 12px rgba(241, 196, 15, 0.8);
      --text-on-primary: black;
    }
    body.theme-green {
      --primary: #27ae60;
      --primary-light: #2ecc71;
      --glow: 0 0 12px rgba(46, 204, 113, 0.8);
      --text-on-primary: white;
    }
    body.theme-blue {
      --primary: #2980b9;
      --primary-light: #3498db;
      --glow: 0 0 12px rgba(52, 152, 219, 0.8);
      --text-on-primary: white;
    }
    body.theme-indigo {
      --primary: #3f51b5;
      --primary-light: #5c6bc0;
      --glow: 0 0 12px rgba(92, 107, 192, 0.8);
      --text-on-primary: white;
    }
    body.theme-pink {
      --primary: #c2185b;
      --primary-light: #e91e63;
      --glow: 0 0 12px rgba(233, 30, 99, 0.8);
      --text-on-primary: white;
    }

    * {
      font-family: 'Comfortaa', cursive;
    }

    body {
      background: var(--bg-dark);
      color: var(--text-light);
      margin: 0;
      padding: 20px;
      scrollbar-width: none;
      -ms-overflow-style: none;
      transition: all 0.3s ease;
      /* Add padding-bottom to prevent bottomBar from overlapping content */
      padding-bottom: 100px;
    }
    
    /* v1.4 Light Mode Styles */
    body.light-mode {
      background: #f0f2f5;
      color: #2c2c2c;
    }
    body.light-mode .overlay {
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(5px);
    }
    body.light-mode #confirmOverlay {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(5px);
    }
    body.light-mode #digitalClock {
      background: #ffffff;
      color: var(--primary);
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    body.light-mode #clockLabel {
      color: #555;
    }
    body.light-mode #clockDisplay {
      color: var(--primary);
    }
    body.light-mode #timer {
      background: #ffffff;
      color: #333;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    body.light-mode .mainBtn {
      background: var(--primary);
      color: var(--text-on-primary);
    }
    body.light-mode .mainBtn:hover {
      background: var(--primary-light);
    }
    body.light-mode .mainBtn.disabledBtn {
      background: #ccc;
      color: #888;
    }
    body.light-mode .mainBtn.disabledBtn:hover {
      background: #ccc;
    }
    body.light-mode select {
      background: #ffffff;
      color: #333;
      border-color: var(--primary);
    }
    body.light-mode #scheduleModal {
      background: #fdfdfd;
      box-shadow: 0 8px 30px rgba(0,0,0,0.1);
    }
    body.light-mode #closeBtn {
      background: var(--primary);
      color: var(--text-on-primary);
    }
    body.light-mode #closeBtn:hover {
      background: var(--primary-light);
    }
    body.light-mode #scheduleModal h2 {
      color: var(--primary);
    }
    body.light-mode #scheduleModal p,
    body.light-mode #scheduleModal label,
    body.light-mode #welcomeLabel {
      color: #333;
    }
    body.light-mode .scheduleTable {
      background: #ffffff;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }
    body.light-mode .scheduleTable th {
      background: var(--primary);
      color: var(--text-on-primary);
    }
    body.light-mode .scheduleTable td {
      border-bottom-color: #eee;
    }
    body.light-mode .scheduleTable tr.highlight {
      background: var(--primary);
      color: var(--text-on-primary);
    }
    body.light-mode .scheduleTable tr:not(.highlight):hover {
      background: #f5f5f5;
    }
    body.light-mode .holidayTable {
      background: #ffffff;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }
    body.light-mode .holidayTable th {
      background: var(--primary);
      color: var(--text-on-primary);
    }
    body.light-mode .holidayTable td {
      border-bottom-color: #eee;
    }
    body.light-mode .holidayTable tr:hover {
      background: #f5f5f5;
    }
    body.light-mode .weekTable {
      background: #ffffff;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }
    body.light-mode .weekTable th {
      background: var(--primary);
      color: var(--text-on-primary);
    }
    body.light-mode .weekTable td {
      border-bottom-color: #eee;
    }
    body.light-mode .weekTable tr:hover {
      background: #f5f5f5;
    }
    body.light-mode #holidayCountdown {
      background: #ffffff;
      color: var(--primary);
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    body.light-mode #holidayCountdownLabel {
      color: #555;
    }
    body.light-mode #holidayCountdownTime {
      color: var(--primary);
    }
    body.light-mode .settingsRow {
      background: #f9f9f9;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }
    body.light-mode .settingsRow label {
      color: #333;
    }
    body.light-mode .notSetLabel {
      color: #777;
    }
    body.light-mode .noSchoolMessage h3 {
      color: var(--primary);
    }
    body.light-mode .noSchoolMessage p {
      color: #333;
    }
    body.light-mode .themeName {
      color: #333;
    }
    body.light-mode .modeToggle {
      background: #f9f9f9;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }
    body.light-mode .gradientToggle {
      background: #f9f9f9;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }
    body.light-mode .modeBtn {
      background: #eee;
      color: #555;
      border-color: var(--primary);
    }
    body.light-mode .modeBtn.selected {
      background: var(--primary);
      color: var(--text-on-primary);
    }
    body.light-mode .modeBtn:hover:not(.selected) {
      background: #e0e0e0;
      color: #333;
    }
    body.light-mode .gradientBtn {
      background: #eee;
      color: #555;
      border-color: var(--primary);
    }
    body.light-mode .gradientBtn.selected {
      background: var(--primary);
      color: var(--text-on-primary);
    }
    body.light-mode .gradientBtn:hover:not(.selected) {
      background: #e0e0e0;
      color: #333;
    }
    body.light-mode .lunchBtn {
      background: #eee;
      color: #555;
      border-color: var(--primary);
    }
    body.light-mode .lunchBtn.selected {
      background: var(--primary);
      color: var(--text-on-primary);
    }
    body.light-mode .lunchBtn:hover:not(.selected) {
      background: #e0e0e0;
      color: #333;
    }
    body.light-mode .continueBtn {
      background: var(--primary);
      color: var(--text-on-primary);
    }
    body.light-mode .continueBtn:hover {
      background: var(--primary-light);
    }
    body.light-mode .resetBtn {
      background: #777;
    }
    body.light-mode .resetBtn:hover {
      background: #c41e3a;
    }
    body.light-mode #settingsBtn {
      background: var(--primary);
      color: var(--text-on-primary);
    }
    body.light-mode #settingsBtn:hover {
      background: var(--primary-light);
    }
    body.light-mode #infoBtn {
      background: var(--primary);
      color: var(--text-on-primary);
    }
    body.light-mode #infoBtn:hover {
      background: var(--primary-light);
    }
    body.light-mode .infoContent h3 {
      color: var(--primary);
    }
    body.light-mode .infoContent p {
      color: #333;
    }
    body.light-mode .infoContent a {
      color: var(--primary);
    }
    body.light-mode .versionBadge {
      background: var(--primary);
      color: var(--text-on-primary);
    }
    body.light-mode #confirmModal {
      background: #fdfdfd;
      box-shadow: 0 8px 30px rgba(0,0,0,0.1);
    }
    body.light-mode #confirmModal h3 {
      color: var(--primary);
    }
    body.light-mode #confirmModal p {
      color: #333;
    }
    body.light-mode .confirmBtn {
      background: var(--primary);
      color: var(--text-on-primary);
    }
    body.light-mode .confirmBtn:hover {
      background: var(--primary-light);
    }
    body.light-mode .cancelBtn {
      background: #777;
    }
    body.light-mode .cancelBtn:hover {
      background: #888;
    }
    body.light-mode #settingsNotification {
      background: #ffffff;
      color: #333;
      border-color: var(--primary);
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    body.light-mode #settingsNotification h4 {
      color: var(--primary);
    }
    body.light-mode #settingsNotification p {
      color: #333;
    }
    body.light-mode #settingsNotification button {
      background: var(--primary);
      color: var(--text-on-primary);
    }
    body.light-mode #settingsNotification button:hover {
      background: var(--primary-light);
    }
    body.light-mode #settingsNotification .dismissBtn {
      background: #777;
    }
    body.light-mode #settingsNotification .dismissBtn:hover {
      background: #888;
    }
    body.light-mode #bottomBar {
      background: #ffffff;
      color: #333;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
    }
    body.light-mode #closeBottomBar {
      color: #555;
    }
    body.light-mode #closeBottomBar:hover {
      background: rgba(0,0,0,0.05);
    }
    /* End v1.4 Light Mode Styles */


    /* Gradient mode */
    body.gradient-mode #digitalClock {
      background: linear-gradient(135deg, var(--primary), var(--primary-light), var(--primary)) !important;
      background-size: 200% 200% !important;
      animation: gradientShift 8s ease infinite !important;
    }

    body.gradient-mode .mainBtn:not(.disabledBtn) {
      background: linear-gradient(135deg, var(--primary), var(--primary-light), var(--primary)) !important;
      background-size: 200% 200% !important;
      animation: gradientShift2 8s ease infinite !important;
    }

    body.gradient-mode .lunchBtn.selected {
      background: linear-gradient(135deg, var(--primary), var(--primary-light), var(--primary)) !important;
      background-size: 200% 200% !important;
      animation: gradientShift4 8s ease infinite !important;
    }

    body.gradient-mode .continueBtn {
      background: linear-gradient(135deg, var(--primary), var(--primary-light), var(--primary)) !important;
      background-size: 200% 200% !important;
      animation: gradientShift2 8s ease infinite !important;
    }

    body.gradient-mode #settingsBtn {
      background: linear-gradient(135deg, var(--primary), var(--primary-light), var(--primary)) !important;
      background-size: 200% 200% !important;
      animation: gradientShift3 8s ease infinite !important;
    }

    body.gradient-mode #infoBtn {
      background: linear-gradient(135deg, var(--primary), var(--primary-light), var(--primary)) !important;
      background-size: 200% 200% !important;
      animation: gradientShift3 8s ease infinite !important;
    }

    body.gradient-mode.light-mode #settingsBtn {
      background: linear-gradient(135deg, var(--primary-light), var(--primary), var(--primary-light)) !important;
      background-size: 200% 200% !important;
      animation: gradientShift3 8s ease infinite !important;
    }

    body.gradient-mode.light-mode #infoBtn {
      background: linear-gradient(135deg, var(--primary-light), var(--primary), var(--primary-light)) !important;
      background-size: 200% 200% !important;
      animation: gradientShift3 8s ease infinite !important;
    }

    body.gradient-mode .scheduleTable th {
      background: linear-gradient(135deg, var(--primary), var(--primary-light), var(--primary)) !important;
      background-size: 200% 200% !important;
      animation: gradientShift5 8s ease infinite !important;
    }

    body.gradient-mode .holidayTable th {
      background: linear-gradient(135deg, var(--primary), var(--primary-light), var(--primary)) !important;
      background-size: 200% 200% !important;
      animation: gradientShift5 8s ease infinite !important;
    }
    
    body.gradient-mode .weekTable th {
      background: linear-gradient(135deg, var(--primary), var(--primary-light), var(--primary)) !important;
      background-size: 200% 200% !important;
      animation: gradientShift5 8s ease infinite !important;
    }

    body.gradient-mode .scheduleTable tr.highlight {
      background: linear-gradient(135deg, var(--primary), var(--primary-light), var(--primary)) !important;
      background-size: 200% 200% !important;
      animation: gradientShift5 8s ease infinite !important;
    }

    body.gradient-mode .modeBtn.selected {
      background: linear-gradient(135deg, var(--primary), var(--primary-light), var(--primary)) !important;
      background-size: 200% 200% !important;
      animation: gradientShift4 8s ease infinite !important;
    }

    body.gradient-mode .gradientBtn.selected {
      background: linear-gradient(135deg, var(--primary), var(--primary-light), var(--primary)) !important;
      background-size: 200% 200% !important;
      animation: gradientShift4 8s ease infinite !important;
    }

    body.gradient-mode .confirmBtn {
      background: linear-gradient(135deg, var(--primary), var(--primary-light), var(--primary)) !important;
      background-size: 200% 200% !important;
      animation: gradientShift2 8s ease infinite !important;
    }

    body.gradient-mode .versionBadge {
      background: linear-gradient(135deg, var(--primary), var(--primary-light), var(--primary)) !important;
      background-size: 200% 200% !important;
      animation: gradientShift5 8s ease infinite !important;
    }

    body.gradient-mode #settingsNotification {
      border-color: var(--primary-light);
      background: linear-gradient(135deg, var(--primary), var(--primary-light), var(--primary)) !important;
      background-size: 200% 200% !important;
      /* v1.4 - Apply base animation + gradient animation */
      animation: gradientShift5 8s ease infinite, slideInFromRight 0.5s ease-out;
    }
    
    body.gradient-mode #settingsNotification.hiding {
      animation: gradientShift5 8s ease infinite, slideOutToRight 0.5s ease-out;
    }
    
    body.gradient-mode #bottomBar {
      background: linear-gradient(135deg, var(--primary), var(--primary-light), var(--primary)) !important;
      background-size: 200% 200% !important;
      animation: gradientShift5 8s ease infinite !important;
    }

    body.gradient-mode.light-mode #settingsNotification {
      background: linear-gradient(135deg, var(--primary-light), var(--primary), var(--primary-light)) !important;
      background-size: 200% 200% !important;
      animation: gradientShift5 8s ease infinite, slideInFromRight 0.5s ease-out;
    }
    
    body.gradient-mode.light-mode #settingsNotification.hiding {
      animation: gradientShift5 8s ease infinite, slideOutToRight 0.5s ease-out;
    }
    
    body.gradient-mode.light-mode #bottomBar {
      background: linear-gradient(135deg, var(--primary-light), var(--primary), var(--primary-light)) !important;
      background-size: 200% 200% !important;
      animation: gradientShift5 8s ease infinite !important;
    }

    /* v1.4 - Gradient light mode overrides */
    body.gradient-mode.light-mode #digitalClock {
      background: linear-gradient(135deg, var(--primary-light), var(--primary), var(--primary-light)) !important;
      background-size: 200% 200% !important;
      animation: gradientShift 8s ease infinite !important;
    }
    
    body.gradient-mode.light-mode .mainBtn:not(.disabledBtn),
    body.gradient-mode.light-mode .continueBtn,
    body.gradient-mode.light-mode .confirmBtn {
      background: linear-gradient(135deg, var(--primary-light), var(--primary), var(--primary-light)) !important;
      background-size: 200% 200% !important;
      animation: gradientShift2 8s ease infinite !important;
    }
    
    body.gradient-mode.light-mode .lunchBtn.selected,
    body.gradient-mode.light-mode .modeBtn.selected,
    body.gradient-mode.light-mode .gradientBtn.selected {
      background: linear-gradient(135deg, var(--primary-light), var(--primary), var(--primary-light)) !important;
      background-size: 200% 200% !important;
      animation: gradientShift4 8s ease infinite !important;
    }
    
    body.gradient-mode.light-mode .scheduleTable th,
    body.gradient-mode.light-mode .holidayTable th,
    body.gradient-mode.light-mode .weekTable th,
    body.gradient-mode.light-mode .scheduleTable tr.highlight,
    body.gradient-mode.light-mode .versionBadge {
      background: linear-gradient(135deg, var(--primary-light), var(--primary), var(--primary-light)) !important;
      background-size: 200% 200% !important;
      animation: gradientShift5 8s ease infinite !important;
    }
    /* v1.4 - End of gradient rules */


    @keyframes gradientShift {
      0% {
        background-position: 0% 50%;
      }
      25% {
        background-position: 100% 25%;
      }
      50% {
        background-position: 0% 75%;
      }
      75% {
        background-position: 100% 50%;
      }
      100% {
        background-position: 0% 50%;
      }
    }

    @keyframes gradientShift2 {
      0% {
        background-position: 100% 0%;
      }
      33% {
        background-position: 0% 100%;
      }
      66% {
        background-position: 50% 50%;
      }
      100% {
        background-position: 100% 0%;
      }
    }

    @keyframes gradientShift3 {
      0% {
        background-position: 50% 100%;
      }
      30% {
        background-position: 100% 0%;
      }
      60% {
        background-position: 0% 50%;
      }
      100% {
        background-position: 50% 100%;
      }
    }

    @keyframes gradientShift4 {
      0% {
        background-position: 25% 75%;
      }
      40% {
        background-position: 75% 25%;
      }
      80% {
        background-position: 0% 100%;
      }
      100% {
        background-position: 25% 75%;
      }
    }

    @keyframes gradientShift5 {
      0% {
        background-position: 75% 25%;
      }
      35% {
        background-position: 25% 75%;
      }
      70% {
        background-position: 100% 100%;
      }
      100% {
        background-position: 75% 25%;
      }
    }
    
    /* v1.4 Rolling Timer Animations */
    @keyframes rollUpIn {
      from { transform: translateY(100%); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    @keyframes rollUpOut {
      from { transform: translateY(0); opacity: 1; }
      to { transform: translateY(-100%); opacity: 0; }
    }
    .digit-roller {
      display: inline-block;
      position: relative;
      overflow: hidden;
      line-height: 1em; /* Match font size */
      height: 1em; /* Match font size */
      vertical-align: middle; /* Align middle of box with middle of text */
    }
    .digit-roller span {
      display: inline-block;
      position: absolute;
      left: 0;
      right: 0;
      text-align: center; /* Ensure centered */
    }
    .digit-roller .old {
      animation: rollUpOut 0.4s ease-out forwards;
    }
    .digit-roller .new {
      transform: translateY(100%);
      animation: rollUpIn 0.4s ease-out forwards;
    }
    .static-char {
      display: inline-block;
      vertical-align: middle; /* Align middle of char with middle of text */
    }

    /* Fade in animation */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
/* NEW — fadeOut animation */
@keyframes fadeOut {
  from { opacity: 1; }
  to { opacity: 0; }
}

/* NEW — apply fade-in to all overlays */
.overlay.active {
  animation: fadeIn 0.3s ease-out;
}

/* NEW — apply fade-out when JS adds .closing */
.overlay.closing {
  animation: fadeOut 0.3s ease-out;
}

/* Make sure closing overlays stay visible and animate out */
.overlay.active.closing {
  display: flex !important;
  animation: fadeOut 0.3s ease-out !important;
}


    h1 {
      animation: fadeInUp 0.6s ease-out;
      text-align: center;
    }

    #digitalClock {
      font-size: clamp(3em, 12vw, 5em);
      font-weight: 700;
      text-align: center;
      color: var(--primary-light);
      background: var(--card-dark);
      padding: 30px;
      border-radius: 16px;
      box-shadow: var(--glow);
      max-width: 650px;
      margin: 20px auto;
      letter-spacing: 0.05em;
    }

    body:not(.gradient-mode) #digitalClock {
      background: var(--primary-light);
      color: var(--text-on-primary);
    }
    
    body:not(.gradient-mode).light-mode #digitalClock {
      background: #ffffff;
      color: var(--primary);
    }

    body:not(.gradient-mode) #clockLabel {
      color: var(--text-on-primary);
      opacity: 0.9;
    }
    
    body:not(.gradient-mode).light-mode #clockLabel {
      color: #555;
      opacity: 1;
    }

    body:not(.gradient-mode) #clockDisplay {
      color: var(--text-on-primary);
    }
    
    body:not(.gradient-mode).light-mode #clockDisplay {
      color: var(--primary);
    }

    #clockLabel {
      font-size: 0.3em;
      margin-bottom: 10px;
      color: var(--text-light);
      opacity: 0.8;
      font-weight: 400;
    }

    body.gradient-mode #clockLabel {
      color: white;
      opacity: 1;
      font-weight: 700;
    }

    body.gradient-mode.light-mode #clockLabel {
      color: #2c2c2c;
      font-weight: 700;
    }

    #clockDisplay {
      color: var(--primary-light);
    }

    body.gradient-mode #clockDisplay {
      color: white;
    }

    body.gradient-mode.light-mode #clockDisplay {
      color: #2c2c2c;
    }

    #timer {
      font-size: clamp(0.9em, 4vw, 1.1em);
      margin-top: 20px;
      text-align: center;
      background: var(--card-dark);
      padding: 15px;
      border-radius: 16px;
      box-shadow: var(--glow);
      max-width: 650px;
      margin: 20px auto;
      color: var(--text-light);
    }

    body.gradient-mode #timer {
      color: white;
      background: linear-gradient(135deg, var(--primary), var(--primary-light), var(--primary));
      background-size: 200% 200%;
      animation: gradientShift 8s ease infinite;
    }

    body.gradient-mode.light-mode #timer {
      color: #2c2c2c;
      background: linear-gradient(135deg, var(--primary-light), var(--primary), var(--primary-light));
      background-size: 200% 200%;
      animation: gradientShift 8s ease infinite;
    }

    #timer.hidden {
      display: none;
    }

    select {
      background: var(--card-dark);
      color: var(--text-light);
      padding: 8px 14px;
      border-radius: 12px;
      border: 1px solid var(--primary-light);
      box-shadow: var(--glow);
      font-size: 1em;
      cursor: pointer;
    }

    .mainButtons {
      display: flex;
      gap: 15px;
      justify-content: center;
      max-width: 650px;
      margin: 30px auto;
      flex-wrap: wrap;
    }

    .mainBtn {
      flex: 1;
      min-width: 200px;
      background: var(--primary-light);
      color: white;
      border: none;
      padding: 15px 30px;
      font-size: 1.1em;
      border-radius: 12px;
      cursor: pointer;
      box-shadow: var(--glow);
      transition: all 0.3s;
      font-weight: 700;
    }

    body:not(.gradient-mode) .mainBtn {
      color: var(--text-on-primary);
    }

    .mainBtn:hover {
      background: var(--primary);
      transform: scale(1.05);
    }

    .mainBtn.disabledBtn {
      opacity: 0.5;
      cursor: not-allowed;
      background: #555;
    }

    .mainBtn.disabledBtn:hover {
      background: #555;
      transform: none;
    }

    .lunchButtons {
      display: flex;
      gap: 10px;
      justify-content: center;
    }

    .lunchBtn {
      flex: 1;
      background: var(--card-dark);
      color: var(--text-light);
      border: 2px solid var(--primary-light);
      padding: 12px 24px;
      font-size: 1em;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 700;
    }

    .lunchBtn:hover {
      background: var(--primary-light);
      color: white;
      transform: scale(1.05);
    }
    
    body:not(.gradient-mode) .lunchBtn:hover {
      color: var(--text-on-primary);
    }

    .lunchBtn.selected {
      background: var(--primary-light);
      color: white;
      box-shadow: var(--glow);
    }

    body:not(.gradient-mode) .lunchBtn.selected {
      color: var(--text-on-primary);
    }

    .lunchBtn:disabled {
      opacity: 1;
      cursor: default;
    }

    .continueBtn {
      display: block;
      width: 100%;
      background: var(--primary-light);
      color: white;
      border: none;
      padding: 15px 40px;
      font-size: 1.1em;
      border-radius: 12px;
      cursor: pointer;
      box-shadow: var(--glow);
      transition: all 0.3s;
      font-weight: 700;
      margin-top: 20px;
    }

    body:not(.gradient-mode) .continueBtn {
      color: var(--text-on-primary);
    }

    .continueBtn:hover {
      background: var(--primary);
      transform: scale(1.05);
    }

    .resetBtn {
      display: block;
      width: 100%;
      background: #555;
      color: white;
      border: none;
      padding: 12px 30px;
      font-size: 1em;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 700;
      margin-top: 20px;
    }

    .resetBtn:hover {
      background: #c41e3a;
      transform: scale(1.05);
    }

    #settingsBtn {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--primary-light);
      color: white;
      border: none;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      font-size: 1.5em;
      cursor: pointer;
      box-shadow: var(--glow);
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1001;
      padding: 0; /* v1.4 centering */
      line-height: 1.1; /* v1.4 centering tweak */
    }

    body:not(.gradient-mode) #settingsBtn {
      color: var(--text-on-primary);
    }

    #settingsBtn:hover {
      background: var(--primary);
      transform: rotate(90deg);
    }

    #infoBtn {
      position: fixed;
      top: 20px;
      right: 80px;
      background: var(--primary-light);
      color: white;
      border: none;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      font-size: 1.5em;
      cursor: pointer;
      box-shadow: var(--glow);
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1001;
      padding: 0; /* v1.4 centering */
      line-height: 1.1; /* v1.4 centering tweak */
    }
    
    body:not(.gradient-mode) #infoBtn {
      color: var(--text-on-primary);
    }

    #infoBtn:hover {
      background: var(--primary);
      transform: scale(1.1);
    }

    #scheduleOverlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(5px);
    }

    #scheduleOverlay.active, #holidaysOverlay.active, #settingsOverlay.active, #welcomeOverlay.active, #lunchSettingsOverlay.active, #themeOverlay.active, #infoOverlay.active, #weekOverlay.active {
      display: flex;
      animation: fadeIn 0.3s ease-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    @keyframes slideInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    #holidaysOverlay, #settingsOverlay, #welcomeOverlay, #lunchSettingsOverlay, #themeOverlay, #infoOverlay, #weekOverlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(5px);
    }

    #scheduleModal {
      background: var(--card-dark);
      padding: 30px;
      border-radius: 16px;
      box-shadow: var(--glow);
      max-width: 650px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
      scrollbar-width: none;
      -ms-overflow-style: none;
      animation: slideInUp 0.4s ease-out;
    }

    #scheduleModal > * {
      animation: fadeInUp 0.5s ease-out backwards;
    }

    #scheduleModal > *:nth-child(1) { animation-delay: 0.1s; }
    #scheduleModal > *:nth-child(2) { animation-delay: 0.15s; }
    #scheduleModal > *:nth-child(3) { animation-delay: 0.2s; }
    #scheduleModal > *:nth-child(4) { animation-delay: 0.25s; }
    #scheduleModal > *:nth-child(5) { animation-delay: 0.3s; }
    #scheduleModal > *:nth-child(6) { animation-delay: 0.35s; }
    #scheduleModal > *:nth-child(7) { animation-delay: 0.4s; }

    #scheduleModal::-webkit-scrollbar {
      display: none;
    }

    #closeBtn {
      position: absolute;
      top: 15px;
      right: 15px;
      background: var(--primary-light);
      color: white;
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      font-size: 1.5em;
      cursor: pointer;
      line-height: 1;
      transition: all 0.3s;
      padding: 0; /* v1.4 centering */
      display: flex; /* v1.4 centering */
      align-items: center; /* v1.4 centering */
      justify-content: center; /* v1.4 centering */
      line-height: 1.1; /* v1.4 centering tweak */
    }
    
    body:not(.gradient-mode) #closeBtn {
      color: var(--text-on-primary);
    }

    #closeBtn:hover {
      background: var(--primary);
      transform: rotate(90deg);
    }

    body.gradient-mode #closeBtn {
      background: linear-gradient(135deg, var(--primary), var(--primary-light), var(--primary)) !important;
      background-size: 200% 200% !important;
      animation: gradientShift3 8s ease infinite !important;
    }

    body.gradient-mode.light-mode #closeBtn {
      background: linear-gradient(135deg, var(--primary-light), var(--primary), var(--primary-light)) !important;
      background-size: 200% 200% !important;
      animation: gradientShift3 8s ease infinite !important;
    }

    #schedule {
      margin-top: 20px;
    }
    
    #weekSchedule {
      margin-top: 20px;
    }

    .scheduleTable {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      background: #1f1f1f;
      border-radius: 12px;
      overflow: hidden;
    }

    .scheduleTable th {
      background: var(--primary-light);
      color: white;
      padding: 12px;
      text-align: left;
      font-weight: 700;
    }

    body:not(.gradient-mode) .scheduleTable th {
      color: var(--text-on-primary);
    }

    .scheduleTable td {
      padding: 12px;
      border-bottom: 1px solid #444;
    }

    .scheduleTable tr:last-child td {
      border-bottom: none;
    }

    .scheduleTable tr.highlight {
      background: var(--primary-light);
      color: white;
      font-weight: 700;
    }

    body:not(.gradient-mode) .scheduleTable tr.highlight {
      color: var(--text-on-primary);
    }

    .scheduleTable tr:not(.highlight):hover {
      background: #2a2a2a;
    }

    .holidayTable {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      background: #1f1f1f;
      border-radius: 12px;
      overflow: hidden;
    }

    .holidayTable th {
      background: var(--primary-light);
      color: white;
      padding: 12px;
      text-align: left;
      font-weight: 700;
    }

    body:not(.gradient-mode) .holidayTable th {
      color: var(--text-on-primary);
    }

    .holidayTable td {
      padding: 12px;
      border-bottom: 1px solid #444;
    }

    .holidayTable tr:last-child td {
      border-bottom: none;
    }

    .holidayTable tr:hover {
      background: #2a2a2a;
    }
    
    .weekTable {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      background: #1f1f1f;
      border-radius: 12px;
      overflow: hidden;
      font-size: clamp(0.9em, 2.5vw, 1em);
    }

    .weekTable th {
      background: var(--primary-light);
      color: white;
      padding: 12px;
      text-align: left;
      font-weight: 700;
    }
    
    body:not(.gradient-mode) .weekTable th {
      color: var(--text-on-primary);
    }

    .weekTable td {
      padding: 12px;
      border-bottom: 1px solid #444;
      line-height: 1.5;
    }
    
    .weekTable td:first-child {
      font-weight: 700;
      white-space: nowrap;
    }
    
    .weekTable td:last-child {
      text-align: right;
    }

    .weekTable tr:last-child td {
      border-bottom: none;
    }

    .weekTable tr:hover {
      background: #2a2a2a;
    }

    #scheduleModal h2 {
      margin-top: 0;
      color: var(--primary-light);
      text-align: center;
      font-weight: 700;
    }

    body.gradient-mode #scheduleModal h2 {
      color: white;
    }

    body.gradient-mode.light-mode #scheduleModal h2 {
      color: #2c2c2c;
    }

    body.gradient-mode #scheduleModal p,
    body.gradient-mode #scheduleModal label,
    body.gradient-mode .infoContent p,
    body.gradient-mode .settingsRow label,
    body.gradient-mode #welcomeLabel {
      color: white;
    }

    body.gradient-mode.light-mode #scheduleModal p,
    body.gradient-mode.light-mode #scheduleModal label,
    body.gradient-mode.light-mode .infoContent p,
    body.gradient-mode.light-mode .settingsRow label,
    body.gradient-mode.light-mode #welcomeLabel {
      color: #2c2c2c;
    }

    #holidayCountdown {
      font-size: clamp(1.5em, 6vw, 3.5em);
      font-weight: 700;
      text-align: center;
      color: var(--primary-light);
      background: var(--card-dark);
      padding: 30px;
      border-radius: 16px;
      box-shadow: var(--glow);
      margin: 20px 0;
      letter-spacing: 0.05em;
    }

    body:not(.gradient-mode) #holidayCountdown {
      background: var(--primary-light);
      color: var(--text-on-primary);
    }
    
    body:not(.gradient-mode).light-mode #holidayCountdown {
      background: #ffffff;
      color: var(--primary);
    }

    body:not(.gradient-mode) #holidayCountdownLabel {
      color: var(--text-on-primary);
      opacity: 0.9;
    }
    
    body:not(.gradient-mode).light-mode #holidayCountdownLabel {
      color: #555;
      opacity: 1;
    }

    body:not(.gradient-mode) #holidayCountdownTime {
      color: var(--text-on-primary);
    }
    
    body:not(.gradient-mode).light-mode #holidayCountdownTime {
      color: var(--primary);
    }

    #holidayCountdownLabel {
      font-size: 0.3em;
      margin-bottom: 10px;
      color: var(--text-light);
      opacity: 0.8;
      font-weight: 400;
    }

    body.gradient-mode #holidayCountdownLabel {
      color: white;
      opacity: 1;
      font-weight: 700;
    }

    body.gradient-mode.light-mode #holidayCountdownLabel {
      color: #2c2c2c;
      font-weight: 700;
    }

    #holidayCountdownTime {
      font-size: 1em;
    }

    body.gradient-mode #holidayCountdownTime {
      color: white;
    }

    body.gradient-mode.light-mode #holidayCountdownTime {
      color: #2c2c2c;
    }

    body.gradient-mode #holidayCountdown {
      background: linear-gradient(135deg, var(--primary), var(--primary-light), var(--primary));
      background-size: 200% 200%;
      animation: gradientShift 8s ease infinite;
    }

    body.gradient-mode.light-mode #holidayCountdown {
      background: linear-gradient(135deg, var(--primary-light), var(--primary), var(--primary-light));
      background-size: 200% 200%;
      animation: gradientShift 8s ease infinite;
    }

    .settingsRow {
      padding: 15px;
      margin: 10px 0;
      background: #1f1f1f;
      border-radius: 12px;
      animation: fadeInUp 0.5s ease-out backwards;
    }

    .settingsRow:nth-of-type(1) { animation-delay: 0.15s; }
    .settingsRow:nth-of-type(2) { animation-delay: 0.2s; }
    .settingsRow:nth-of-type(3) { animation-delay: 0.25s; }
    .settingsRow:nth-of-type(4) { animation-delay: 0.3s; }
    .settingsRow:nth-of-type(5) { animation-delay: 0.35s; }

    .settingsRow label {
      display: block;
      margin-bottom: 8px;
      font-weight: 700;
    }

    .dayLabel {
      font-size: 0.9em;
      color: var(--text-light);
      opacity: 0.8;
      margin-bottom: 5px;
    }

    .notSetLabel {
      text-align: center;
      color: var(--text-light);
      opacity: 0.6;
      font-style: italic;
      padding: 10px;
    }

    .noSchoolMessage {
      text-align: center;
      padding: 40px 20px;
      font-size: 1.3em;
    }

    .noSchoolMessage h3 {
      font-size: 2em;
      margin-bottom: 20px;
      color: var(--primary-light);
      margin-top: 0;
    }

    .noSchoolMessage p {
      font-size: 1.2em;
      color: var(--text-light);
      opacity: 0.8;
      margin: 0;
    }

    body.gradient-mode .noSchoolMessage h3 {
      color: white;
    }

    body.gradient-mode.light-mode .noSchoolMessage h3 {
      color: #2c2c2c;
    }

    body.gradient-mode .noSchoolMessage p {
      color: white;
      opacity: 1;
    }

    body.gradient-mode.light-mode .noSchoolMessage p {
      color: #2c2c2c;
      opacity: 1;
    }

    .themeGrid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      padding: 20px 0;
    }

    .modeToggle {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-bottom: 30px;
      padding: 15px;
      background: #1f1f1f;
      border-radius: 12px;
    }

    .modeBtn {
      flex: 1;
      background: var(--card-dark);
      color: var(--text-light);
      border: 2px solid var(--primary-light);
      padding: 12px 24px;
      font-size: 1em;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 700;
    }

    .modeBtn:hover {
      background: var(--primary-light);
      color: white;
      transform: scale(1.05);
    }
    
    body:not(.gradient-mode) .modeBtn:hover {
      color: var(--text-on-primary);
    }

    .modeBtn.selected {
      background: var(--primary-light);
      color: white;
      box-shadow: var(--glow);
    }
    
    body:not(.gradient-mode) .modeBtn.selected {
      color: var(--text-on-primary);
    }

    .gradientToggle {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-bottom: 30px;
      padding: 15px;
      background: #1f1f1f;
      border-radius: 12px;
    }

    .gradientBtn {
      flex: 1;
      background: var(--card-dark);
      color: var(--text-light);
      border: 2px solid var(--primary-light);
      padding: 12px 24px;
      font-size: 1em;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 700;
    }

    .gradientBtn:hover {
      background: var(--primary-light);
      color: white;
      transform: scale(1.05);
    }
    
    body:not(.gradient-mode) .gradientBtn:hover {
      color: var(--text-on-primary);
    }

    .gradientBtn.selected {
      background: var(--primary-light);
      color: white;
      box-shadow: var(--glow);
    }
    
    body:not(.gradient-mode) .gradientBtn.selected {
      color: var(--text-on-primary);
    }

    .themeOption {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      transition: all 0.3s;
      animation: fadeInUp 0.5s ease-out backwards;
    }

    .themeOption:nth-child(1) { animation-delay: 0.2s; }
    .themeOption:nth-child(2) { animation-delay: 0.25s; }
    .themeOption:nth-child(3) { animation-delay: 0.3s; }
    .themeOption:nth-child(4) { animation-delay: 0.35s; }
    .themeOption:nth-child(5) { animation-delay: 0.4s; }
    .themeOption:nth-child(6) { animation-delay: 0.45s; }
    .themeOption:nth-child(7) { animation-delay: 0.5s; }
    .themeOption:nth-child(8) { animation-delay: 0.55s; }

    .themeOption:hover .themeCircle {
      transform: scale(1.1);
    }

    .themeCircle {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      border: 3px solid transparent;
      transition: all 0.3s;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    .themeOption.selected .themeCircle {
      border-color: white;
      box-shadow: 0 0 20px currentColor;
    }
    
    body.light-mode .themeOption.selected .themeCircle {
      border-color: #000;
    }

    .themeName {
      font-size: 0.9em;
      color: var(--text-light);
      font-weight: 700;
    }

    @media (max-width: 600px) {
      .themeGrid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      #infoBtn {
        top: 80px;
        right: 20px;
      }
    }

    .infoContent {
      text-align: center;
      padding: 20px;
    }

    .infoContent h3 {
      color: var(--primary-light);
      margin-top: 20px;
      margin-bottom: 10px;
    }

    body.gradient-mode .infoContent h3 {
      color: white;
    }

    body.gradient-mode.light-mode .infoContent h3 {
      color: #2c2c2c;
    }

    .infoContent p {
      margin: 10px 0;
      line-height: 1.6;
    }

    .infoContent a {
      color: var(--primary-light);
      text-decoration: none;
      font-weight: 700;
    }

    body.gradient-mode .infoContent a {
      color: white;
    }

    body.gradient-mode.light-mode .infoContent a {
      color: #2c2c2c;
    }

    .infoContent a:hover {
      text-decoration: underline;
    }

    .versionBadge {
      display: inline-block;
      background: var(--primary-light);
      color: white;
      padding: 8px 20px;
      border-radius: 20px;
      font-size: 1.2em;
      font-weight: 700;
      margin: 20px 0;
      box-shadow: var(--glow);
    }

    body:not(.gradient-mode) .versionBadge {
      color: var(--text-on-primary);
    }

    #confirmOverlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      z-index: 2000;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(5px);
    }

    #confirmOverlay.active {
      display: flex;
      animation: fadeIn 0.3s ease-out;
    }

    #confirmOverlay.closing {
      animation: fadeOut 0.3s ease-out;
    }
/* WELCOME OVERLAY FADE FIX */
#welcomeOverlay.active {
  display: flex;
  animation: fadeIn 0.3s ease-out;
}

#welcomeOverlay.closing {
  animation: fadeOut 0.3s ease-out;
}

    #confirmModal {
      background: var(--card-dark);
      padding: 40px;
      border-radius: 16px;
      box-shadow: var(--glow);
      max-width: 500px;
      width: 90%;
      text-align: center;
      animation: slideInUp 0.4s ease-out;
    }

    #confirmModal h3 {
      color: var(--primary-light);
      margin-top: 0;
      margin-bottom: 20px;
      font-size: 1.5em;
    }

    body.gradient-mode #confirmModal h3 {
      color: white;
    }

    body.gradient-mode.light-mode #confirmModal h3 {
      color: #2c2c2c;
    }

    body.gradient-mode #confirmModal p {
      color: white;
    }

    body.gradient-mode.light-mode #confirmModal p {
      color: #2c2c2c;
    }

    #confirmModal p {
      margin-bottom: 30px;
      line-height: 1.6;
      font-size: 1.1em;
    }

    .confirmButtons {
      display: flex;
      gap: 15px;
      justify-content: center;
    }

    .confirmBtn {
      flex: 1;
      background: var(--primary-light);
      color: white;
      border: none;
      padding: 15px 30px;
      font-size: 1.1em;
      border-radius: 12px;
      cursor: pointer;
      box-shadow: var(--glow);
      transition: all 0.3s;
      font-weight: 700;
    }

    body:not(.gradient-mode) .confirmBtn {
      color: var(--text-on-primary);
    }

    .confirmBtn:hover {
      background: var(--primary);
      transform: scale(1.05);
    }

    .cancelBtn {
      flex: 1;
      background: #555;
      color: white;
      border: none;
      padding: 15px 30px;
      font-size: 1.1em;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 700;
    }

    .cancelBtn:hover {
      background: #666;
      transform: scale(1.05);
    }

    #settingsNotification {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: var(--card-dark);
      color: var(--text-light);
      padding: 20px 25px;
      border-radius: 16px;
      box-shadow: var(--glow);
      max-width: 300px;
      z-index: 999;
      border: 2px solid var(--primary-light);
      display: none;
    }

    #settingsNotification.show {
      display: block;
      animation: slideInFromRight 0.5s ease-out;
    }

    @keyframes slideInFromRight {
      from {
        opacity: 0;
        transform: translateX(100px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes slideOutToRight {
      from {
        opacity: 1;
        transform: translateX(0);
      }
      to {
        opacity: 0;
        transform: translateX(100px);
      }
    }

    #settingsNotification.hiding {
      animation: slideOutToRight 0.5s ease-out;
    }

    #settingsNotification h4 {
      margin: 0 0 10px 0;
      color: var(--primary-light);
      font-size: 1.2em;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    body.gradient-mode #settingsNotification h4 {
      color: white;
    }

    body.gradient-mode.light-mode #settingsNotification h4 {
      color: #2c2c2c;
    }

    #settingsNotification p {
      margin: 0 0 15px 0;
      line-height: 1.5;
      font-size: 0.95em;
    }

    body.gradient-mode #settingsNotification p {
      color: white;
    }

    body.gradient-mode.light-mode #settingsNotification p {
      color: #2c2c2c;
    }

    #settingsNotification button {
      width: 100%;
      background: var(--primary-light);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 700;
      font-size: 1em;
      transition: all 0.3s;
      margin-bottom: 8px;
    }
    
    body:not(.gradient-mode) #settingsNotification button {
      color: var(--text-on-primary);
    }

    #settingsNotification button:hover {
      background: var(--primary);
      transform: scale(1.05);
    }

    #settingsNotification .dismissBtn {
      background: #555;
      margin-bottom: 0;
    }
    
    body:not(.gradient-mode) #settingsNotification .dismissBtn {
      color: white;
    }

    #settingsNotification .dismissBtn:hover {
      background: #666;
    }
    
    /* v1.4 General Notification Styles */
    .notification-pop {
      display: none; /* Hidden by default */
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: var(--card-dark);
      color: var(--text-light);
      padding: 20px 25px;
      border-radius: 16px;
      box-shadow: var(--glow);
      max-width: 300px;
      z-index: 999;
      border: 2px solid var(--primary-light);
    }
    .notification-pop.show {
      display: block;
      animation: slideInFromRight 0.5s ease-out;
    }
    .notification-pop.hiding {
      animation: slideOutToRight 0.5s ease-out;
    }
    .notification-pop h4 {
      margin: 0 0 10px 0;
      color: var(--primary-light);
      font-size: 1.2em;
    }
    .notification-pop p {
      margin: 0 0 15px 0;
      line-height: 1.5;
      font-size: 0.95em;
    }
    .notification-pop .dismissBtn {
      width: 100%;
      background: #555;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 700;
      font-size: 1em;
      transition: all 0.3s;
      margin-bottom: 0;
    }
    .notification-pop .dismissBtn:hover {
      background: #666;
    }
    /* Light mode */
    body.light-mode .notification-pop {
      background: #ffffff;
      color: #333;
      border-color: var(--primary);
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    body.light-mode .notification-pop h4 {
      color: var(--primary);
    }
    body.light-mode .notification-pop p {
      color: #333;
    }
    body.light-mode .notification-pop .dismissBtn {
      background: #777;
    }
    body.light-mode .notification-pop .dismissBtn:hover {
      background: #888;
    }
    /* Gradient mode */
    body.gradient-mode .notification-pop {
      border-color: var(--primary-light);
      background: linear-gradient(135deg, var(--primary), var(--primary-light), var(--primary)) !important;
      background-size: 200% 200% !important;
      animation: gradientShift5 8s ease infinite, slideInFromRight 0.5s ease-out;
    }
    body.gradient-mode .notification-pop.hiding {
        animation: gradientShift5 8s ease infinite, slideOutToRight 0.5s ease-out;
    }
    body.gradient-mode .notification-pop h4,
    body.gradient-mode .notification-pop p {
        color: white;
    }
    body.gradient-mode.light-mode .notification-pop {
        background: linear-gradient(135deg, var(--primary-light), var(--primary), var(--primary-light)) !important;
        animation: gradientShift5 8s ease infinite, slideInFromRight 0.5s ease-out;
    }
    body.gradient-mode.light-mode .notification-pop.hiding {
        animation: gradientShift5 8s ease infinite, slideOutToRight 0.5s ease-out;
    }
    body.gradient-mode.light-mode .notification-pop h4,
    body.gradient-mode.light-mode .notification-pop p {
        color: #2c2c2c;
    }

    @media (max-width: 600px) {
      #settingsNotification, .notification-pop {
        bottom: 20px;
        right: 20px;
        left: 20px;
        max-width: none;
      }
      
      #bottomBar {
        left: 0;
        right: 0;
        bottom: -200px;
        padding: 15px;
        border-radius: 0;
      }
      
      #bottomBar.show {
        bottom: 0;
      }
    }
    
    #bottomBar {
      position: fixed;
      bottom: -200px; /* Start off-screen */
      left: 0;
      right: 0;
      z-index: 998;
      background: var(--bg-dark);
      color: var(--text-light);
      padding: 20px 30px;
      border-radius: 16px 16px 0 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 15px;
      transition: bottom 0.6s ease-out;
      font-size: 0.9em;
    }
    
    #bottomBar.show {
      bottom: 0; /* Slide in to the bottom edge */
    }
    
    #closeBottomBar {
      background: none;
      border: none;
      color: var(--text-light);
      opacity: 0.7;
      font-size: 1.5em;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      line-height: 1;
      /* v1.4 Centering */
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      line-height: 1.1; /* v1.4 centering tweak */
    }
    
    #closeBottomBar:hover {
      opacity: 1;
      transform: scale(1.1) rotate(90deg);
      background: rgba(255, 255, 255, 0.1);
    }
    
    body.gradient-mode #closeBottomBar {
      color: white;
    }
    
    body.gradient-mode.light-mode #closeBottomBar {
      color: #2c2c2c;
    }
    
    body.gradient-mode #bottomBar p {
      color: white;
    }
    
    body.gradient-mode.light-mode #bottomBar p {
      color: #2c2c2c;
    }

  </style>
</head>
<body class="theme-purple">
  <h1>LW Schedule</h1>

  <button id="infoBtn" onclick="toggleInfo()">i</button>
  <button id="settingsBtn" onclick="toggleSettings()">⚙️</button>

  <div id="digitalClock">
    <div id="clockLabel">TIME REMAINING</div>
    <div id="clockDisplay">--:--:--</div>
  </div>

  <div id="timer"></div>

  <div class="mainButtons">
    <button class="mainBtn" id="scheduleBtn" onclick="toggleSchedule()">View Today's Schedule</button>
    <button class="mainBtn" onclick="toggleWeekSchedule()">View Week's Schedule</button>
    <button class="mainBtn" onclick="toggleHolidays()">Upcoming Holidays</button>
  </div>

  <div id="scheduleOverlay" class="overlay" onclick="closeOverlay(event)">
    <div id="scheduleModal">
      <button id="closeBtn" onclick="closeOverlayGracefully('scheduleOverlay')">×</button>
      <h2>Today's Schedule</h2>
      <div id="schedule"></div>
    </div>
  </div>

  <div id="weekOverlay" class="overlay" onclick="closeWeekScheduleOverlay(event)">
    <div id="scheduleModal">
      <button id="closeBtn" onclick="closeOverlayGracefully('weekOverlay')">×</button>
      <h2>This Week's Schedule</h2>
      <div id="weekSchedule"></div>
    </div>
  </div>

<div id="holidaysOverlay" class="overlay" onclick="closeHolidaysOverlay(event)">
    <div id="scheduleModal">
      <button id="closeBtn" onclick="closeOverlayGracefully('holidaysOverlay')">×</button>
      <h2>Upcoming Holidays 2025-26</h2>
      <div id="holidayCountdown">
        <div id="holidayCountdownLabel">NEXT HOLIDAY</div>
        <div id="holidayCountdownTime">--d --h --m --s</div>
      </div>
      <div id="holidays">
        <table class="holidayTable">
          <thead>
            <tr>
              <th>Holiday</th>
              <th>Date</th>
            </tr>
          </thead>
          <tbody id="holidayTableBody">
            <!-- Holidays will be dynamically populated -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

<div id="settingsOverlay" class="overlay" onclick="closeSettingsOverlay(event)">
    <div id="scheduleModal">
      <button id="closeBtn" onclick="closeOverlayGracefully('settingsOverlay')">×</button>
      <h2>Settings</h2>
      <div class="settingsRow">
        <button class="mainBtn" onclick="toggleLunchSettings()">Lunch Preferences</button>
      </div>
      <div class="settingsRow">
        <button class="mainBtn" onclick="toggleTheme()">Theme</button>
      </div>
      <div class="settingsRow">
        <button class="mainBtn disabledBtn" disabled>Classes (Coming Soon)</button>
      </div>
      <div class="settingsRow">
        <button class="mainBtn disabledBtn" disabled>Pack Up Reminder (Coming Soon)</button>
      </div>
      <button class="resetBtn" onclick="resetAllSettings()">Reset All Settings to Default</button>
    </div>
  </div>

<div id="infoOverlay" class="overlay" onclick="closeInfoOverlay(event)">
    <div id="scheduleModal">
      <button id="closeBtn" onclick="closeOverlayGracefully('infoOverlay')">×</button>
      <h2>About</h2>
      <div class="infoContent">
        <div class="versionBadge">Version 1.4</div>
        
        <h3>Created By</h3>
        <p>Sanchit P.</p>
        
        <h3>GitHub Repository</h3>
        <p><a href="https://github.com/lwschedule/lwschedule.github.io" target="_blank">View on GitHub</a></p>
        
        <h3>Inspired By</h3>
        <p><a href="https://schedule-manager.lwhsftc.org/" target="_blank">LW Schedule Manager</a><br>by Rudra Pandit</p>
      </div>
    </div>
  </div>

<div id="themeOverlay" class="overlay" onclick="closeThemeOverlay(event)">
    <div id="scheduleModal">
      <button id="closeBtn" onclick="closeOverlayGracefully('themeOverlay')">×</button>
      <h2>Choose Your Theme</h2>
      
      <div class="modeToggle">
        <button class="modeBtn" id="darkModeBtn" onclick="selectMode('dark')">🌙 Dark Mode</button>
        <button class="modeBtn" id="lightModeBtn" onclick="selectMode('light')">☀️ Light Mode</button>
      </div>

      <div class="gradientToggle">
        <button class="gradientBtn" id="gradientOffBtn" onclick="selectGradient('off')">Static Colors</button>
        <button class="gradientBtn" id="gradientOnBtn" onclick="selectGradient('on')">✨ Animated Gradient</button>
      </div>

      <div class="themeGrid">
        <div class="themeOption" data-theme="purple" onclick="selectTheme('purple')">
          <div class="themeCircle" style="background: linear-gradient(135deg, #4b2e83, #6a4fb3);"></div>
          <span class="themeName">Purple</span>
        </div>
        <div class="themeOption" data-theme="red" onclick="selectTheme('red')">
          <div class="themeCircle" style="background: linear-gradient(135deg, #c41e3a, #e63946);"></div>
          <span class="themeName">Red</span>
        </div>
        <div class="themeOption" data-theme="orange" onclick="selectTheme('orange')">
          <div class="themeCircle" style="background: linear-gradient(135deg, #d35400, #e67e22);"></div>
          <span class="themeName">Orange</span>
        </div>
        <div class="themeOption" data-theme="yellow" onclick="selectTheme('yellow')">
          <div class="themeCircle" style="background: linear-gradient(135deg, #c29d00, #f1c40f);"></div>
          <span class="themeName">Yellow</span>
        </div>
        <div class="themeOption" data-theme="green" onclick="selectTheme('green')">
          <div class="themeCircle" style="background: linear-gradient(135deg, #27ae60, #2ecc71);"></div>
          <span class="themeName">Green</span>
        </div>
        <div class="themeOption" data-theme="blue" onclick="selectTheme('blue')">
          <div class="themeCircle" style="background: linear-gradient(135deg, #2980b9, #3498db);"></div>
          <span class="themeName">Blue</span>
        </div>
        <div class="themeOption" data-theme="indigo" onclick="selectTheme('indigo')">
          <div class="themeCircle" style="background: linear-gradient(135deg, #3f51b5, #5c6bc0);"></div>
          <span class="themeName">Indigo</span>
        </div>
        <div class="themeOption" data-theme="pink" onclick="selectTheme('pink')">
          <div class="themeCircle" style="background: linear-gradient(135deg, #c2185b, #e91e63);"></div>
          <span class="themeName">Pink</span>
        </div>
      </div>

      <button class="resetBtn" onclick="resetTheme()">Reset to Default Theme</button>
    </div>
  </div>

<div id="lunchSettingsOverlay" class="overlay" onclick="closeLunchSettingsOverlay(event)">
    <div id="scheduleModal">
      <button id="closeBtn" onclick="closeOverlayGracefully('lunchSettingsOverlay')">×</button>
      <h2>Lunch Preferences</h2>
      <div class="settingsRow">
        <label>Monday Lunch:</label>
        <div class="lunchButtons" id="mondayButtons">
          <button class="lunchBtn" id="mondayA" onclick="selectDayLunch('Monday', 'A')">A Lunch</button>
          <button class="lunchBtn" id="mondayB" onclick="selectDayLunch('Monday', 'B')">B Lunch</button>
        </div>
        <div class="notSetLabel" id="mondayNotSet" style="display:none;">Lunch not selected yet</div>
      </div>
      <div class="settingsRow">
        <label>Tuesday Lunch:</label>
        <div class="lunchButtons" id="tuesdayButtons">
          <button class="lunchBtn" id="tuesdayA" onclick="selectDayLunch('Tuesday', 'A')">A Lunch</button>
          <button class="lunchBtn" id="tuesdayB" onclick="selectDayLunch('Tuesday', 'B')">B Lunch</button>
        </div>
        <div class="notSetLabel" id="tuesdayNotSet" style="display:none;">Lunch not selected yet</div>
      </div>
      <div class="settingsRow">
        <label>Wednesday Lunch:</label>
        <div class="lunchButtons">
          <button class="lunchBtn selected" disabled>All School Lunch</button>
        </div>
      </div>
      <div class="settingsRow">
        <label>Thursday Lunch:</label>
        <div class="lunchButtons" id="thursdayButtons">
          <button class="lunchBtn" id="thursdayA" onclick="selectDayLunch('Thursday', 'A')">A Lunch</button>
          <button class="lunchBtn" id="thursdayB" onclick="selectDayLunch('Thursday', 'B')">B Lunch</button>
        </div>
        <div class="notSetLabel" id="thursdayNotSet" style="display:none;">Lunch not selected yet</div>
      </div>
      <div class="settingsRow">
        <label>Friday Lunch:</label>
        <div class="lunchButtons" id="fridayButtons">
          <button class="lunchBtn" id="fridayA" onclick="selectDayLunch('Friday', 'A')">A Lunch</button>
          <button class="lunchBtn" id="fridayB" onclick="selectDayLunch('Friday', 'B')">B Lunch</button>
        </div>
        <div class="notSetLabel" id="fridayNotSet" style="display:none;">Lunch not selected yet</div>
      </div>
      <button class="resetBtn" onclick="resetLunches()">Reset All Lunches</button>
    </div>
  </div>

<div id="welcomeOverlay" class="overlay">
    <div id="scheduleModal">
      <h2>Select Your Lunch</h2>
      <div class="settingsRow">
        <label id="welcomeLabel">Please select your lunch:</label>
        <div class="lunchButtons">
          <button class="lunchBtn" id="welcomeA" onclick="selectWelcomeLunch('A')">A Lunch</button>
          <button class="lunchBtn" id="welcomeB" onclick="selectWelcomeLunch('B')">B Lunch</button>
        </div>
      </div>
      <button class="continueBtn" onclick="saveWelcomeLunch()">Continue</button>
    </div>
  </div>

  <div id="confirmOverlay">
    <div id="confirmModal">
      <h3 id="confirmTitle">Confirm Action</h3>
      <p id="confirmMessage">Are you sure?</p>
      <div class="confirmButtons">
        <button class="cancelBtn" onclick="closeConfirm()">Cancel</button>
        <button class="confirmBtn" onclick="confirmAction()">Confirm</button>
      </div>
    </div>
  </div>

  <div id="settingsNotification">
    <h4>⚙️ New Here?</h4>
    <p>Check out the settings to customize your lunch preferences and choose your favorite theme!</p>
    <button onclick="openSettingsFromNotification()">Open Settings</button>
    <button class="dismissBtn" onclick="dismissNotification()">Dismiss</button>
  </div>

  <div id="bottomBar">
    <p>Made by Sanchit P. • Inspired by Rudy P.</p>
    <button id="closeBottomBar" onclick="closeBottomBar()">×</button>
  </div>
  
  <div id="generalNotification" class="notification-pop">
    <h4 id="notificationTitle"></h4>
    <p id="notificationMessage"></p>
    <button class="dismissBtn" onclick="dismissGeneralNotification()">Dismiss</button>
  </div>

  <script>
    // Save lunch choices per day
    let lunchPreferences = {
      Monday: null,
      Tuesday: null,
      Wednesday: 'All',
      Thursday: null,
      Friday: null
    };
    let selectedWelcomeLunch = 'A';
    let currentTheme = 'purple';
    let currentMode = 'dark';
    let gradientMode = 'on';
    let confirmCallback = null;
    let currentHolidayMessage = null;
    let currentAfterSchoolMessage = null;
    let lastMessageDay = null;
    let currentNotificationId = null;
    
    // v1.4 Holiday List (for reset logic and countdown)
    const holidays = [
      { name: "Labor Day", date: new Date(2025, 8, 1), displayDate: "September 1, 2025" },
      { name: "LEAP Day", date: new Date(2025, 9, 17), displayDate: "October 17, 2025" },
      { name: "LEAP Day", date: new Date(2025, 10, 4), displayDate: "November 4, 2025" },
      { name: "Veterans Day", date: new Date(2025, 10, 11), displayDate: "November 11, 2025" },
      { name: "Thanksgiving Break", date: new Date(2025, 10, 27), displayDate: "November 27-28, 2025" },
      { name: "Winter Break", date: new Date(2025, 11, 22), displayDate: "December 22, 2025 - January 2, 2026" },
      { name: "MLK Jr. Day", date: new Date(2026, 0, 19), displayDate: "January 19, 2026" },
      { name: "Mid-Winter Break", date: new Date(2026, 1, 12), displayDate: "February 12-13, 2026" },
      { name: "Presidents Day", date: new Date(2026, 1, 16), displayDate: "February 16, 2026" },
      { name: "LEAP Day", date: new Date(2026, 2, 13), displayDate: "March 13, 2026" },
      { name: "Spring Break", date: new Date(2026, 3, 13), displayDate: "April 13-17, 2026" },
      { name: "LEAP Day", date: new Date(2026, 4, 22), displayDate: "May 22, 2026" },
      { name: "Memorial Day", date: new Date(2026, 4, 25), displayDate: "May 25, 2026" },
      { name: "Last Day of School", date: new Date(2026, 5, 17), displayDate: "June 17, 2026" }
    ];
    
    // v1.4 Function to update rolling timers
    function updateRollingText(element, newText) {
        let oldText = element.dataset.previousText || element.textContent;
        
        if (oldText === newText) {
            return; // No change
        }

        // If it's not a timer (e.g., "Homework Time!"), just update
        if (!newText.match(/^[\d: -]+$/) && !newText.match(/d|h|m|s/)) {
             if (oldText !== newText) element.textContent = newText;
             element.dataset.previousText = newText;
             return;
        }

        element.dataset.previousText = newText;
        
        let html = '';
        let newChars = newText.split('');
        let oldChars = oldText.split('');
        
        let len = Math.max(newChars.length, oldChars.length);

        for (let i = 0; i < len; i++) {
            let newChar = newChars[i] || '';
            let oldChar = oldChars[i] || '';

            if (newChar === oldChar) {
                html += `<span class="static-char">${newChar}</span>`;
            } else {
                // Estimate width
                let width = '0.6em'; // Default for numbers
                if (newChar === ':' || newChar === '.') width = '0.3em';
                if (newChar === ' ') width = '0.2em';
                if (['d', 'h', 'm', 's'].includes(newChar)) width = '0.5em';

                html += `<span class="digit-roller" style="width: ${width}; height: 1em; line-height: 1em;">`;
                html += `<span class="old">${oldChar}</span>`;
                html += `<span class="new">${newChar}</span>`;
                html += `</span>`;
            }
        }
        element.innerHTML = html;
    }

    
    function showConfirm(title, message, callback) {
      document.getElementById('confirmTitle').textContent = title;
      document.getElementById('confirmMessage').textContent = message;
      confirmCallback = callback;
      document.getElementById('confirmOverlay').classList.add('active');
    }

    function closeConfirm() {
      const overlay = document.getElementById('confirmOverlay');
      overlay.classList.add('closing');
      setTimeout(() => {
        overlay.classList.remove('active');
        overlay.classList.remove('closing');
        confirmCallback = null;
      }, 300);
    }

    function confirmAction() {
      if (confirmCallback) {
        confirmCallback();
      }
      closeConfirm();
    }
    
    function loadLunchPreferences() {
      try {
        const saved = localStorage.getItem('lunch-preferences');
        if (saved) {
          lunchPreferences = JSON.parse(saved);
        }
      } catch (error) {
        console.log('No saved preferences, using defaults');
      }
      
      // Update settings buttons
      updateSettingsButtons();
    }

    function loadTheme() {
      try {
        const savedTheme = localStorage.getItem('theme');
        const savedMode = localStorage.getItem('mode');
        const savedGradient = localStorage.getItem('gradient');
        
        if (savedTheme) {
          currentTheme = savedTheme;
        }
        if (savedMode) {
          currentMode = savedMode;
        }
        if (savedGradient) {
          gradientMode = savedGradient;
        }
        
        applyTheme();
        applyMode();
        applyGradient();
      } catch (error) {
        console.log('No saved theme, using defaults');
      }
    }

    function applyTheme() {
      // Remove all theme classes first
      document.body.className = document.body.className
        .split(' ')
        .filter(c => !c.startsWith('theme-'))
        .join(' ');
      
      // Add the current theme
      document.body.classList.add(`theme-${currentTheme}`);
    }

    function applyMode() {
      if (currentMode === 'light') {
        document.body.classList.add('light-mode');
      } else {
        document.body.classList.remove('light-mode');
      }
    }

    function applyGradient() {
      if (gradientMode === 'on') {
        document.body.classList.add('gradient-mode');
      } else {
        document.body.classList.remove('gradient-mode');
      }
    }

    function selectGradient(mode) {
      gradientMode = mode;
      applyGradient();
      
      try {
        localStorage.setItem('gradient', mode);
      } catch (error) {
        console.error('Failed to save gradient mode:', error);
      }
      
      updateGradientSelection();
    }

    function updateGradientSelection() {
      document.getElementById('gradientOffBtn').classList.toggle('selected', gradientMode === 'off');
      document.getElementById('gradientOnBtn').classList.toggle('selected', gradientMode === 'on');
    }

    function selectTheme(theme) {
      currentTheme = theme;
      applyTheme();
      
      try {
        localStorage.setItem('theme', theme);
      } catch (error) {
        console.error('Failed to save theme:', error);
      }
      
      updateThemeSelection();
    }

    function selectMode(mode) {
      currentMode = mode;
      applyMode();
      
      try {
        localStorage.setItem('mode', mode);
      } catch (error) {
        console.error('Failed to save mode:', error);
      }
      
      updateModeSelection();
    }

    function updateThemeSelection() {
      document.querySelectorAll('.themeOption').forEach(option => {
        if (option.dataset.theme === currentTheme) {
          option.classList.add('selected');
        } else {
          option.classList.remove('selected');
        }
      });
    }

    function updateModeSelection() {
      document.getElementById('darkModeBtn').classList.toggle('selected', currentMode === 'dark');
      document.getElementById('lightModeBtn').classList.toggle('selected', currentMode === 'light');
    }

    function resetTheme() {
      showConfirm(
        'Reset Theme',
        'Are you sure you want to reset the theme to default (Purple, Dark Mode, Animated Gradient)?',
        () => {
          currentTheme = 'purple';
          currentMode = 'dark';
          gradientMode = 'on'; // v1.4 - Default gradient is ON
          applyTheme();
          applyMode();
          applyGradient();
          
          try {
            localStorage.setItem('theme', 'purple');
            localStorage.setItem('mode', 'dark');
            localStorage.setItem('gradient', 'on');
          } catch (error) {
            console.error('Failed to save theme:', error);
          }
          
          updateThemeSelection();
          updateModeSelection();
          updateGradientSelection();
        }
      );
    }

    function resetLunches() {
      showConfirm(
        'Reset Lunch Preferences',
        'Are you sure you want to reset all lunch preferences?',
        () => {
          lunchPreferences = {
            Monday: null,
            Tuesday: null,
            Wednesday: 'All',
            Thursday: null,
            Friday: null
          };
          
          try {
            localStorage.removeItem('lunch-preferences');
            const days = ['Monday', 'Tuesday', 'Thursday', 'Friday'];
            days.forEach(day => {
              localStorage.removeItem(`lunch-set-${day}`);
            });
          } catch (error) {
            console.error('Failed to reset lunches:', error);
          }
          
          updateSettingsButtons();
          render();
        }
      );
    }

    function resetAllSettings() {
      showConfirm(
        'Reset All Settings',
        'Are you sure you want to reset ALL settings to default? This will reset your theme and lunch preferences.',
        () => {
          // Reset theme
          currentTheme = 'purple';
          currentMode = 'dark';
          gradientMode = 'on'; // v1.4 - Default gradient is ON
          applyTheme();
          applyMode();
          applyGradient();
          
          // Reset lunches
          lunchPreferences = {
            Monday: null,
            Tuesday: null,
            Wednesday: 'All',
            Thursday: null,
            Friday: null
          };
          
          try {
            // Clear all stored data
            localStorage.removeItem('theme');
            localStorage.removeItem('mode');
            localStorage.removeItem('gradient');
            localStorage.removeItem('lunch-preferences');
            localStorage.removeItem('has-opened-settings');
            localStorage.removeItem('bottom-bar-dismissed');
            // v1.4 - Clear notification flags
            localStorage.removeItem('semester-reset-2026');
            localStorage.removeItem('notify-sem-2026');
            localStorage.removeItem('notify-q3-2026');
            
            const days = ['Monday', 'Tuesday', 'Thursday', 'Friday'];
            days.forEach(day => {
              localStorage.removeItem(`lunch-set-${day}`);
            });
          } catch (error) {
            console.error('Failed to reset settings:', error);
          }
          
          updateSettingsButtons();
          updateThemeSelection();
          updateModeSelection();
          updateGradientSelection();
          render();
          
          checkSettingsNotification();
          checkBottomBar();
        }
      );
    }

    function updateSettingsButtons() {
      const days = ['Monday', 'Tuesday', 'Thursday', 'Friday'];
      
      days.forEach(day => {
        const dayLower = day.toLowerCase();
        const hasSelection = lunchPreferences[day] !== null;
        
        // Always show buttons, hide "not set" label when there's a selection
        document.getElementById(`${dayLower}Buttons`).style.display = 'flex';
        document.getElementById(`${dayLower}NotSet`).style.display = hasSelection ? 'none' : 'block';
        
        // Update button selection state
        document.getElementById(`${dayLower}A`).classList.toggle('selected', lunchPreferences[day] === 'A');
        document.getElementById(`${dayLower}B`).classList.toggle('selected', lunchPreferences[day] === 'B');
      });
    }

    function selectWelcomeLunch(lunch) {
      selectedWelcomeLunch = lunch;
      document.getElementById('welcomeA').classList.toggle('selected', lunch === 'A');
      document.getElementById('welcomeB').classList.toggle('selected', lunch === 'B');
    }

    function selectDayLunch(day, lunch) {
      lunchPreferences[day] = lunch;
      updateSettingsButtons();
      saveDayLunch(day);
    }
    
    function saveDayLunch(day) {
      try {
        localStorage.setItem('lunch-preferences', JSON.stringify(lunchPreferences));
        localStorage.setItem(`lunch-set-${day}`, new Date().toDateString());
      } catch (error) {
        console.error('Failed to save lunch preference:', error);
      }
      render();
    }

    function saveWelcomeLunch() {
      const today = currentDayName();
      if (today === 'Wednesday') {
        lunchPreferences[today] = 'All';
      } else {
        lunchPreferences[today] = selectedWelcomeLunch;
      }
      
      try {
        localStorage.setItem('lunch-preferences', JSON.stringify(lunchPreferences));
        localStorage.setItem(`lunch-set-${today}`, new Date().toDateString());
      } catch (error) {
        console.error('Failed to save lunch preference:', error);
      }
      
      updateSettingsButtons();
      closeOverlayGracefully('welcomeOverlay');
      render();
    }

    function checkIfNeedsLunchSelection() {
      const today = currentDayName();
      
      // Wednesday always has all-school lunch, no need to ask
      if (today === 'Wednesday') {
        return false;
      }
      
      // Check if not a school day
      if (!today || today === 'Saturday' || today === 'Sunday') {
        return false;
      }
      
      try {
        const lastSet = localStorage.getItem(`lunch-set-${today}`);
        const todayDate = new Date().toDateString();
        
        // If lunch is null or not set for today, show popup
        if (lunchPreferences[today] === null || !lastSet || lastSet !== todayDate) {
          // Haven't set lunch for today yet
          document.getElementById('welcomeLabel').innerHTML = `Select your lunch for ${today}:`;
          selectedWelcomeLunch = lunchPreferences[today] || 'A';
          document.getElementById('welcomeA').classList.toggle('selected', selectedWelcomeLunch === 'A');
          document.getElementById('welcomeB').classList.toggle('selected', selectedWelcomeLunch === 'B');
          document.getElementById('welcomeOverlay').classList.add('active');
          return true;
        }
      } catch (error) {
        // No record exists, show welcome
        document.getElementById('welcomeLabel').innerHTML = `Select your lunch for ${today}:`;
        selectedWelcomeLunch = lunchPreferences[today] || 'A';
        document.getElementById('welcomeA').classList.toggle('selected', selectedWelcomeLunch === 'A');
        document.getElementById('welcomeB').classList.toggle('selected', selectedWelcomeLunch === 'B');
        document.getElementById('welcomeOverlay').classList.add('active');
        return true;
      }
      
      return false;
    }
    
    // v1.4 Semester Lunch Reset Check
    function checkSemesterReset() {
      try {
        // Find the last day of school to determine the current school year
        const lastDay = holidays.find(h => h.name === "Last Day of School");
        if (!lastDay) return; // Can't determine school year
        
        const schoolYearEnd = lastDay.date;
        const schoolYear = schoolYearEnd.getFullYear(); // e.g., 2026
        
        const now = new Date();
        const currentYear = now.getFullYear();
        const currentMonth = now.getMonth(); // 0 = Jan
        const currentDate = now.getDate(); // 1-31

        // Reset date is Jan 24.
        // If school year ends in 2026, the reset date is Jan 24, 2026.
        const resetYear = schoolYear; 
        const resetMonth = 0; // January
        const resetDate = 24;
        
        // Check if today is the reset date for the *current* school year
        if (currentYear === resetYear && currentMonth === resetMonth && currentDate === resetDate) {
          const resetFlag = `semester-reset-${resetYear}`;
          const hasReset = localStorage.getItem(resetFlag);
          
          if (!hasReset) {
            // Perform the reset
            
            // 1. Clear lunch preferences
            lunchPreferences = {
              Monday: null,
              Tuesday: null,
              Wednesday: 'All',
              Thursday: null,
              Friday: null
            };
            localStorage.removeItem('lunch-preferences');
            
            // 2. Clear all 'lunch-set' keys
            const days = ['Monday', 'Tuesday', 'Thursday', 'Friday'];
            days.forEach(day => {
              localStorage.removeItem(`lunch-set-${day}`);
            });
            
            // 3. Set the flag so it doesn't run again this year
            localStorage.setItem(resetFlag, 'true');
            
            // 4. Force welcome overlay to show (will be triggered by checkIfNeedsLunchSelection)
            // This function runs before loadLunchPreferences, so the cleared prefs
            // will be loaded, and then checkIfNeedsLunchSelection will trigger the popup.
          }
        }
      } catch (error) {
        console.error('Error during semester reset check:', error);
      }
    }

    // Initialize app
    function initApp() {
      checkSemesterReset(); // v1.4 - Run this first
      loadTheme();
      loadLunchPreferences();
      const needsLunch = checkIfNeedsLunchSelection();
      if (!needsLunch) {
        render();
      }
      setInterval(render, 1000);
      setInterval(updateHolidayCountdown, 1000);
      
      checkSettingsNotification();
      checkAnnualNotifications(); // v1.4 - Add this
      checkBottomBar();
      
      // v1.4 - Check notifications periodically
      setInterval(checkAnnualNotifications, 60 * 1000); // Check every minute
    }

    function checkBottomBar() {
      setTimeout(() => {
        document.getElementById('bottomBar').classList.add('show');
      }, 1500);
    }


    function closeBottomBar() {
      document.getElementById('bottomBar').classList.remove('show');
    }

    function checkSettingsNotification() {
      try {
        const hasOpenedSettings = localStorage.getItem('has-opened-settings');
        if (!hasOpenedSettings) {
          setTimeout(() => {
            // v1.4 - Don't show if another notification is already up
            if (!document.getElementById('generalNotification').classList.contains('show')) {
              document.getElementById('settingsNotification').classList.add('show');
            }
          }, 5000);
        }
      } catch (error) {
        console.log('Could not check settings notification status');
      }
    }
    
    // v1.4 General Notifications
    function checkAnnualNotifications() {
      const now = new Date();
      const year = now.getFullYear();
      const month = now.getMonth(); // 0 = Jan, 3 = Apr
      const date = now.getDate();
      
      let notification = null;
      
      // Jan 23: Semester ending
      if (month === 0 && date === 23) {
        notification = {
          id: `notify-sem-${year}`,
          title: "🔔 Heads Up!",
          message: "The semester is ending soon. Good luck on finals!"
        };
      }
      
      // Apr 3: Quarter 3 ending
      if (month === 3 && date === 3) {
        notification = {
          id: `notify-q3-${year}`,
          title: "🔔 Heads Up!",
          message: "Quarter 3 is ending soon. Finish strong!"
        };
      }
      
      if (notification) {
        try {
          const hasSeen = localStorage.getItem(notification.id);
          if (!hasSeen) {
            // Show notification, but only if school is not over
            const schedules = getSchedules(new Date());
            const today = schedules[currentDayName()];
            if (today && today.length > 0) {
                const lastPeriod = today[today.length - 1];
                const nowMins = minutesNow();
                if (nowMins < lastPeriod.end) {
                     showGeneralNotification(notification.id, notification.title, notification.message);
                }
            }
          }
        } catch (error) {
          console.error('Failed to check notification status:', error);
        }
      }
    }
    
    function showGeneralNotification(id, title, message) {
      // Don't show if settings notification is already up
      if (document.getElementById('settingsNotification').classList.contains('show')) {
        return;
      }
      
      currentNotificationId = id;
      document.getElementById('notificationTitle').textContent = title;
      document.getElementById('notificationMessage').textContent = message;
      document.getElementById('generalNotification').classList.add('show');
    }
    
    function dismissGeneralNotification() {
      const notification = document.getElementById('generalNotification');
      notification.classList.add('hiding');
      setTimeout(() => {
        notification.classList.remove('show');
        notification.classList.remove('hiding');
      }, 500);
      
      if (currentNotificationId) {
        try {
          localStorage.setItem(currentNotificationId, 'true');
        } catch (error) {
          console.error('Failed to save notification status:', error);
        }
        currentNotificationId = null;
      }
    }
    // End v1.4 Notifications

    function dismissNotification() {
      const notification = document.getElementById('settingsNotification');
      notification.classList.add('hiding');
      setTimeout(() => {
        notification.classList.remove('show');
        notification.classList.remove('hiding');
      }, 500);
      
      try {
        localStorage.setItem('has-opened-settings', 'true');
      } catch (error) {
        console.error('Failed to save notification status:', error);
      }
    }

    function openSettingsFromNotification() {
      dismissNotification();
      setTimeout(() => {
        toggleSettings();
      }, 500);
    }

    initApp();

    function toggleSchedule() {
      const overlay = document.getElementById('scheduleOverlay');
      
      if (overlay.classList.contains('active')) {
        closeOverlayGracefully('scheduleOverlay');
        // Reset the message when closing so next open gets a new one
        currentHolidayMessage = null;
      } else {
        overlay.classList.add('active');
        // Generate new message if opening and it's a holiday
        const schedules = getSchedules(new Date());
        const today = schedules[currentDayName()];
        if (!today || today.length === 0) {
          const funMessages = [
            "Have fun!",
            "Go outside!",
            "Relax and recharge!",
            "Enjoy your free time!",
            "Make it a great day!",
            "Time to unwind!",
            "Do something you love!",
            "Rest up for tomorrow!",
            "Adventure awaits!",
            "Explore something new!"
          ];
          currentHolidayMessage = funMessages[Math.floor(Math.random() * funMessages.length)];
          document.getElementById('schedule').innerHTML = `
            <div class="noSchoolMessage">
              <h3>No School Today</h3>
              <p>${currentHolidayMessage}</p>
            </div>
          `;
        }
      }
    }
    
    function toggleWeekSchedule() {
      const overlay = document.getElementById('weekOverlay');
      if (overlay.classList.contains('active')) {
        closeOverlayGracefully('weekOverlay');
      } else {
        overlay.classList.add('active');
        updateWeekSchedule();
      }
    }

    function toggleHolidays() {
      const overlay = document.getElementById('holidaysOverlay');
      if (overlay.classList.contains('active')) {
        closeOverlayGracefully('holidaysOverlay');
      } else {
        overlay.classList.add('active');
        updateHolidayCountdown();
        updateHolidayTable();
      }
    }

    function toggleSettings() {
      const overlay = document.getElementById('settingsOverlay');
      if (overlay.classList.contains('active')) {
        closeOverlayGracefully('settingsOverlay');
      } else {
        overlay.classList.add('active');
        
        // Mark that user has opened settings
        try {
          localStorage.setItem('has-opened-settings', 'true');
        } catch (error) {
          console.error('Failed to save settings status:', error);
        }
      }
    }

    function toggleInfo() {
      const overlay = document.getElementById('infoOverlay');
      if (overlay.classList.contains('active')) {
        closeOverlayGracefully('infoOverlay');
      } else {
        overlay.classList.add('active');
      }
    }

    function toggleLunchSettings() {
      const overlay = document.getElementById('lunchSettingsOverlay');
      if (overlay.classList.contains('active')) {
        closeOverlayGracefully('lunchSettingsOverlay');
      } else {
        overlay.classList.add('active');
      }
    }

    function toggleTheme() {
      const overlay = document.getElementById('themeOverlay');
      if (overlay.classList.contains('active')) {
        closeOverlayGracefully('themeOverlay');
      } else {
        overlay.classList.add('active');
        updateThemeSelection();
        updateModeSelection();
        updateGradientSelection();
      }
    }

  function closeOverlayGracefully(overlayId) {
  const overlay = document.getElementById(overlayId);
  
  // Start fade out
  overlay.classList.add('closing');
  
  // Wait for animation to complete, then hide
  setTimeout(() => {
    overlay.classList.remove('active');
    overlay.classList.remove('closing');
  }, 300); // Match your animation duration
}

    function closeOverlay(event) {
      if (event.target === document.getElementById('scheduleOverlay')) {
        closeOverlayGracefully('scheduleOverlay');
      }
    }
    
    function closeWeekScheduleOverlay(event) {
      if (event.target === document.getElementById('weekOverlay')) {
        closeOverlayGracefully('weekOverlay');
      }
    }

    function closeHolidaysOverlay(event) {
      if (event.target === document.getElementById('holidaysOverlay')) {
        closeOverlayGracefully('holidaysOverlay');
      }
    }

    function closeSettingsOverlay(event) {
      if (event.target === document.getElementById('settingsOverlay')) {
        closeOverlayGracefully('settingsOverlay');
      }
    }

    function closeInfoOverlay(event) {
      if (event.target === document.getElementById('infoOverlay')) {
        closeOverlayGracefully('infoOverlay');
      }
    }

    function closeLunchSettingsOverlay(event) {
      if (event.target === document.getElementById('lunchSettingsOverlay')) {
        closeOverlayGracefully('lunchSettingsOverlay');
      }
    }

    // Check if current date is Veterans Day week (Nov 10-14, 2025)
    function isVeteransWeek(date) {
      const now = date;
      const year = now.getFullYear();
      const month = now.getMonth();
      const day = now.getDate();
      
      // November 2025, dates 10-14
      return year === 2025 && month === 10 && day >= 10 && day <= 14;
    }

    // Check if current date is Thanksgiving week (Nov 24-28, 2025)
    function isThanksgivingWeek(date) {
      const now = date;
      const year = now.getFullYear();
      const month = now.getMonth();
      const day = now.getDate();
      
      // November 2025, dates 24-28
      return year === 2025 && month === 10 && day >= 24 && day <= 28;
    }

    // Check if current date is MLK Jr. Day / Finals week (Jan 19-23, 2026)
    function isFinalsWeek(date) {
      const now = date;
      const year = now.getFullYear();
      const month = now.getMonth();
      const day = now.getDate();
      
      // January 2026, dates 19-23
      return year === 2026 && month === 0 && day >= 19 && day <= 23;
    }

    // Bell schedule (simplified times in minutes after midnight)
    function getSchedules(date) {
      const today = getDayNameFromDate(date);
      const lunch = lunchPreferences[today] || 'A';
      
      // Finals week special schedule (Jan 19-23, 2026)
      if (isFinalsWeek(date)) {
        return {
          Monday: [], // No school - MLK Jr. Day
          Tuesday: [
            { name:"Period 1", start: 8*60+35, end: 9*60+20 },
            { name:"Period 2", start: 9*60+30, end: 10*60+50 },
            ...(lunch === 'A' ? [
              { name:"A Lunch", start: 10*60+50, end: 11*60+20 },
              { name:"Period 4", start: 11*60+30, end: 12*60+50 }
            ] : [
              { name:"Period 4", start: 11*60, end: 12*60+20 },
              { name:"B Lunch", start: 12*60+20, end: 12*60+50 }
            ]),
            { name:"Period 4", start: 13*60, end: 13*60+45 },
            { name:"Period 6", start: 13*60+55, end: 15*60+15 }
          ],
          Wednesday: [
            { name:"Period 1", start: 8*60+35, end: 9*60+55 },
            { name:"Period 3", start: 10*60+5, end: 11*60+25 },
            { name:"Period 5", start: 11*60+35, end: 12*60+55 },
            { name:"Lunch", start: 13*60, end: 13*60+30 },
          ],
          Thursday: [
            { name:"Period 2", start: 8*60+35, end: 9*60+55 },
            { name:"Period 3", start: 10*60+5, end: 10*60+50 },
            ...(lunch === 'A' ? [
              { name:"A Lunch", start: 10*60+50, end: 11*60+20 },
              { name:"Period 4", start: 11*60+30, end: 12*60+50 }
            ] : [
              { name:"Period 4", start: 11*60, end: 12*60+20 },
              { name:"B Lunch", start: 12*60+20, end: 12*60+50 }
            ]),
            { name:"Period 5", start: 13*60, end: 13*60+45 },
            { name:"Period 6", start: 13*60+55, end: 15*60+15 }
          ],
          Friday: [
            { name:"Period 1", start: 8*60+35, end: 9*60+55 },
            { name:"Period 2", start: 10*60+5, end: 10*60+50 },
            ...(lunch === 'A' ? [
              { name:"A Lunch", start: 10*60+50, end: 11*60+20 },
              { name:"Period 3", start: 11*60+30, end: 12*60+50 }
            ] : [
              { name:"Period 3", start: 11*60, end: 12*60+20 },
              { name:"B Lunch", start: 12*60+20, end: 12*60+50 }
            ]),
            { name:"Period 5", start: 13*60, end: 14*60+20 },
            { name:"Period 6", start: 14*60+30, end: 15*60+15 }
          ]
        };
      }
      
      // Thanksgiving week special schedule (Nov 24-28, 2025)
      if (isThanksgivingWeek(date)) {
        return {
          Monday: [
            { name:"Period 1", start: 8*60+35, end: 9*60+30 },
            { name:"Period 2", start: 9*60+38, end: 10*60+33 },
            { name:"Period 3", start: 10*60+41, end: 11*60+36 },
            ...(lunch === 'A' ? [
              { name:"A Lunch", start: 11*60+36, end: 12*60+6 },
              { name:"Period 4", start: 12*60+14, end: 13*60+9 }
            ] : [
              { name:"Period 4", start: 11*60+44, end: 12*60+39 },
              { name:"B Lunch", start: 12*60+39, end: 13*60+9 }
            ]),
            { name:"Period 5", start: 13*60+17, end: 14*60+12 },
            { name:"Period 6", start: 14*60+20, end: 15*60+15 }
          ],
          Tuesday: [
            { name:"Period 1", start: 8*60+35, end: 9*60+23 },
            { name:"Homeroom/Personalization", start: 9*60+30, end: 10*60+10 },
            { name:"Period 2", start: 10*60+17, end: 11*60+5 },
            ...(lunch === 'A' ? [
              { name:"A Lunch", start: 11*60+5, end: 11*60+35 },
              { name:"Period 3", start: 11*60+42, end: 12*60+30 }
            ] : [
              { name:"Period 3", start: 11*60+12, end: 12*60 },
              { name:"B Lunch", start: 12*60, end: 12*60+30 }
            ]),
            { name:"Period 4", start: 12*60+37, end: 13*60+25 },
            { name:"Period 5", start: 13*60+32, end: 14*60+20 },
            { name:"Period 6", start: 14*60+27, end: 15*60+15 }
          ],
          Wednesday: [
            { name:"Period 1", start: 8*60+35, end: 9*60 },
            { name:"Period 2", start: 9*60+7, end: 9*60+32 },
            { name:"Period 3", start: 9*60+39, end: 10*60+4 },
            { name:"Period 4", start: 10*60+11, end: 10*60+36 },
            { name:"Period 5", start: 10*60+43, end: 11*60+8 },
            { name:"Period 6", start: 11*60+15, end: 11*60+40 },
            { name:"Breakfast Served - No Lunch", start: 11*60+40, end: 11*60+40 }
          ],
          Thursday: [], // No school - Thanksgiving Break
          Friday: [] // No school - Thanksgiving Break
        };
      }
      
      // Veterans Day week special schedule (Nov 10-14, 2025)
      if (isVeteransWeek(date)) {
        return {
          Monday: [
            { name:"Period 1", start: 8*60+35, end: 9*60+30 },
            { name:"Period 2", start: 9*60+38, end: 10*60+33 },
            { name:"Period 3", start: 10*60+41, end: 11*60+36 },
            ...(lunch === 'A' ? [
              { name:"A Lunch", start: 11*60+36, end: 12*60+6 },
              { name:"Period 4", start: 12*60+14, end: 13*60+9 }
            ] : [
              { name:"Period 4", start: 11*60+44, end: 12*60+39 },
              { name:"B Lunch", start: 12*60+39, end: 13*60+9 }
            ]),
            { name:"Period 5", start: 13*60+17, end: 14*60+12 },
            { name:"Period 6", start: 14*60+20, end: 15*60+15 }
          ],
          Tuesday: [], // No school - Veterans Day
          Wednesday: [
            { name:"Period 1", start: 8*60+35, end: 9*60+12 },
            { name:"Period 2", start: 9*60+19, end: 9*60+56 },
            { name:"Period 3", start: 10*60+3, end: 10*60+40 },
            { name:"Period 4", start: 10*60+47, end: 11*60+24 },
            { name:"Period 5", start: 11*60+31, end: 12*60+8 },
            { name:"Period 6", start: 12*60+15, end: 12*60+52 },
            { name:"Lunch", start: 12*60+52, end: 13*60+30 },
          ],
          Thursday: [
            { name:"Period 1", start: 8*60+35, end: 9*60+30 },
            { name:"Period 2", start: 9*60+38, end: 10*60+33 },
            { name:"Period 3", start: 10*60+41, end: 11*60+36 },
            ...(lunch === 'A' ? [
              { name:"A Lunch", start: 11*60+36, end: 12*60+6 },
              { name:"Period 4", start: 12*60+14, end: 13*60+9 }
            ] : [
              { name:"Period 4", start: 11*60+44, end: 12*60+39 },
              { name:"B Lunch", start: 12*60+39, end: 13*60+9 }
            ]),
            { name:"Period 5", start: 13*60+17, end: 14*60+12 },
            { name:"Period 6", start: 14*60+20, end: 15*60+15 }
          ],
          Friday: [
            { name:"Period 1", start: 8*60+35, end: 9*60+23 },
            { name:"Homeroom/Personalization", start: 9*60+30, end: 10*60+10 },
            { name:"Period 2", start: 10*60+17, end: 11*60+5 },
            ...(lunch === 'A' ? [
              { name:"A Lunch", start: 11*60+5, end: 11*60+35 },
              { name:"Period 3", start: 11*60+42, end: 12*60+30 }
            ] : [
              { name:"Period 3", start: 11*60+12, end: 12*60 },
              { name:"B Lunch", start: 12*60, end: 12*60+30 }
            ]),
            { name:"Period 4", start: 12*60+37, end: 13*60+25 },
            { name:"Period 5", start: 13*60+32, end: 14*60+20 },
            { name:"Period 6", start: 14*60+27, end: 15*60+15 }
          ]
        };
      }
      
      // Regular schedule
      return {
        Monday: [
          { name:"Period 1", start: 8*60+35, end: 9*60+55 },
          { name:"Period 2", start: 10*60+5, end: 10*60+50 },
          ...(lunch === 'A' ? [
            { name:"A Lunch", start: 10*60+50, end: 11*60+20 },
            { name:"Period 3", start: 11*60+30, end: 12*60+50 }
          ] : [
            { name:"Period 3", start: 11*60, end: 12*60+20 },
            { name:"B Lunch", start: 12*60+20, end: 12*60+50 }
          ]),
          { name:"Period 5", start: 13*60, end: 14*60+20 },
          { name:"Period 6", start: 14*60+30, end: 15*60+15 }
        ],
        Tuesday: [ // v1.4 - Tuesday P4 Override
          { name:"Period 1", start: 8*60+35, end: 9*60+20 }, // 8:35 - 9:20
          { name:"Period 2", start: 9*60+30, end: 10*60+50 }, // 9:30 - 10:50
          ...(lunch === 'A' ? [
            { name:"A Lunch", start: 10*60+50, end: 11*60+20 }, // 10:50 - 11:20
            { name:"Period 4 (Part 1)", start: 11*60+30, end: 12*60+50 }, // 11:30 - 12:50
          ] : [
            { name:"Period 4 (Part 1)", start: 11*60, end: 12*60+20 }, // 11:00 - 12:20
            { name:"B Lunch", start: 12*60+20, end: 12*60+50 }, // 12:20 - 12:50
          ]),
          { name:"Break", start: 12*60+50, end: 13*60 }, // 12:50 - 1:00
          { name:"Period 4 (Part 2)", start: 13*60, end: 13*60+45 }, // 1:00 - 1:45
          { name:"Period 6", start: 13*60+55, end: 15*60+15 } // 1:55 - 3:15
        ],
        Wednesday: [
          { name:"Period 1", start: 8*60+35, end: 9*60+55 },
          { name:"Period 3", start: 10*60+5, end: 11*60+25 },
          { name:"Period 5", start: 11*60+35, end: 12*60+55 },
          { name:"Lunch", start: 13*60, end: 13*60+30 },
        ],
        Thursday: [
          { name:"Period 2", start: 8*60+35, end: 9*60+55 },
          { name:"Period 3", start: 10*60+5, end: 10*60+50 },
          ...(lunch === 'A' ? [
            { name:"A Lunch", start: 10*60+50, end: 11*60+20 },
            { name:"Period 4", start: 11*60+30, end: 12*60+50 }
          ] : [
            { name:"Period 4", start: 11*60, end: 12*60+20 },
            { name:"B Lunch", start: 12*60+20, end: 12*60+50 }
          ]),
          { name:"Period 6", start: 13*60+55, end: 15*60+15 }
        ],
        Friday: [
          { name:"Period 1", start: 8*60+35, end: 9*60+23 },
          { name:"Homeroom", start: 9*60+30, end: 10*60+10 },
          { name:"Period 2", start: 10*60+17, end: 11*60+5 },
          ...(lunch === 'A' ? [
            { name:"A Lunch", start: 11*60+5, end: 11*60+35 },
            { name:"Period 3", start: 11*60+42, end: 12*60 }
          ] : [
            { name:"Period 3", start: 11*60+42, end: 12*60 },
            { name:"B Lunch", start: 12*60, end: 12*60+30 }
          ]),
          { name:"Period 4", start: 12*60+37, end: 13*60+25 },
          { name:"Period 5", start: 13*60+32, end: 14*60+20 },
          { name:"Period 6", start: 14*60+27, end: 15*60+15 }
        ]
      };
    }

    function getDayNameFromDate(date) {
      return date.toLocaleDateString('en-US', { weekday: 'long' });
    }

    function currentDayName() {
      return getDayNameFromDate(new Date());
    }

    function minutesNow() {
      const d = new Date();
      return d.getHours()*60 + d.getMinutes();
    }

    function secondsNow() {
      return new Date().getSeconds();
    }

    function format(m) {
      let h = Math.floor(m/60);
      const mm = m%60;
      const ampm = h >= 12 ? 'PM' : 'AM';
      h = h % 12;
      h = h ? h : 12;
      return `${h}:${mm.toString().padStart(2,'0')} ${ampm}`;
    }

    function formatTime(minutes, seconds) {
      let h = Math.floor(minutes/60);
      const m = minutes%60;
      const s = seconds;
      const ampm = h >= 12 ? 'PM' : 'AM';
      h = h % 12;
      h = h ? h : 12;
      return `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')} ${ampm}`;
    }

    function formatCountdown(totalMinutes, totalSeconds) {
      if (totalSeconds === 60) {
        totalMinutes += 1;
        totalSeconds = 0;
      }

      const h = Math.floor(totalMinutes / 60);
      const m = totalMinutes % 60;
      const s = totalSeconds;

      if (h > 0) {
        return `${h.toString()} : ${m.toString().padStart(2, '0')} : ${s.toString().padStart(2, '0')}`;
      } else {
        return `${m.toString().padStart(2, '0')} : ${s.toString().padStart(2, '0')}`;
      }
    }

    function updateHolidayTable() {
      const now = new Date();
      const upcomingHolidays = holidays.filter(h => h.date > now);
      const tbody = document.getElementById('holidayTableBody');
      
      if (upcomingHolidays.length === 0) {
        tbody.innerHTML = '<tr><td colspan="2" style="text-align:center;">No more holidays this school year!</td></tr>';
        return;
      }
      
      let html = '';
      upcomingHolidays.forEach((holiday, index) => {
        const isNext = index === 0;
        html += `<tr class="${isNext ? 'highlight' : ''}">
          <td><b>${holiday.name}</b></td>
          <td>${holiday.displayDate}</td>
        </tr>`;
      });
      
      tbody.innerHTML = html;
    }
    
    function getHolidayForDate(date) {
      const checkTime = new Date(date.getFullYear(), date.getMonth(), date.getDate()).getTime();

      for (const holiday of holidays) {
        const holidayTime = new Date(holiday.date.getFullYear(), holiday.date.getMonth(), holiday.date.getDate()).getTime();

        // Check for single-day holiday
        if (checkTime === holidayTime) {
          return holiday.name;
        }

        // Check for multi-day breaks
        // Thanksgiving Break
        if (holiday.name === "Thanksgiving Break") {
            const start = holidayTime;
            const end = new Date(2025, 10, 28).getTime();
            if (checkTime >= start && checkTime <= end) return holiday.name;
        }
        // Winter Break
        if (holiday.name === "Winter Break") {
            const start = holidayTime;
            const end = new Date(2026, 0, 2).getTime();
            if (checkTime >= start && checkTime <= end) return holiday.name;
        }
        // Mid-Winter Break
        if (holiday.name === "Mid-Winter Break") {
            const start = holidayTime;
            const end = new Date(2026, 1, 13).getTime();
            if (checkTime >= start && checkTime <= end) return holiday.name;
        }
        // Spring Break
        if (holiday.name === "Spring Break") {
            const start = holidayTime;
            const end = new Date(2026, 3, 17).getTime();
            if (checkTime >= start && checkTime <= end) return holiday.name;
        }
      }
      return null; // No holiday found
    }
    
    function updateWeekSchedule() {
      const scheduleEl = document.getElementById('weekSchedule');
      let html = `<table class="weekTable">
                    <thead>
                      <tr>
                        <th>Day</th>
                        <th>Schedule</th>
                      </tr>
                    </thead>
                    <tbody>`;
      
      const now = new Date();
      const currentDayOfWeek = now.getDay(); // 0=Sun, 1=Mon, ..., 6=Sat
      const monday = new Date(now);
      const diff = currentDayOfWeek === 0 ? -6 : 1 - currentDayOfWeek; // Get to Monday
      monday.setDate(now.getDate() + diff);
      
      const weekDays = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
      
      for (let i = 0; i < 5; i++) {
        const dayDate = new Date(monday);
        dayDate.setDate(monday.getDate() + i);
        
        const dayNameStr = weekDays[i];
        const holidayName = getHolidayForDate(dayDate);
        
        let summary = '';
        
        if (holidayName) {
          summary = holidayName;
        } else {
          const schedules = getSchedules(dayDate);
          const schedule = schedules[dayNameStr];
        
          if (!schedule || schedule.length === 0) {
            summary = 'No School';
          } else {
            let names = schedule.map(p => p.name);
            // Filter out breaks
            names = names.filter(n => n !== "Break" && n !== "Period 4 (Part 2)");
            
            const simplifiedNames = names.map(n => {
              if (n.startsWith("Period 1")) return "1";
              if (n.startsWith("Period 2")) return "2";
              if (n.startsWith("Period 3")) return "3";
              if (n.startsWith("Period 4")) return "4";
              if (n.startsWith("Period 5")) return "5";
              if (n.startsWith("Period 6")) return "6";
              if (n.includes("Lunch")) return "Lunch";
              if (n.includes("Homeroom")) return "HR";
              // LEAP removed as requested
              if (n === "Breakfast Served - No Lunch") return "Min. Day";
              return n;
            });
          
            const uniqueNames = [...new Set(simplifiedNames)];
            summary = uniqueNames.join(', ');
          }
        }
        
        html += `<tr>
                  <td>${dayNameStr}</td>
                  <td>${summary}</td>
                </tr>`;
      }
      
      html += '</tbody></table>';
      scheduleEl.innerHTML = html;
    }

    function updateHolidayCountdown() {
      const now = new Date();
      const upcoming = holidays.find(h => h.date > now);
      const countdownEl = document.getElementById('holidayCountdownTime');
      
      if (upcoming) {
        const diff = upcoming.date - now;
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((diff % (1000 * 60)) / 1000);
        
        document.getElementById('holidayCountdownLabel').innerHTML = `NEXT HOLIDAY - ${upcoming.name}`;
        updateRollingText(countdownEl, 
          `${days} d ${hours.toString().padStart(2,'0')} h ${minutes.toString().padStart(2,'0')} m ${seconds.toString().padStart(2,'0')} s`);
      } else {
        document.getElementById('holidayCountdownLabel').innerHTML = 'NO UPCOMING HOLIDAYS';
        updateRollingText(countdownEl, 'End of school year');
      }
      
      updateHolidayTable();
    }

    function render() {
      const schedules = getSchedules(new Date());
      const today = schedules[currentDayName()];
      const clockDisplay = document.getElementById('clockDisplay');
      
      const scheduleBtn = document.getElementById('scheduleBtn');
      if (!today || today.length === 0) {
        scheduleBtn.textContent = 'Holiday Today';
      } else {
        scheduleBtn.textContent = "View Today's Schedule";
      }
      
      if (!today || today.length === 0) {
        updateRollingText(clockDisplay, "--:--:--");
        clockDisplay.style.fontSize = ''; // v1.4 Reset font size
        document.getElementById('clockLabel').innerHTML = "NO SCHOOL TODAY";
        document.getElementById('timer').innerHTML = "Enjoy your day off!";
        document.getElementById('timer').classList.remove('hidden');
        
        if (currentHolidayMessage) {
          document.getElementById('schedule').innerHTML = `
            <div class="noSchoolMessage">
              <h3>No School Today</h3>
              <p>${currentHolidayMessage}</p>
            </div>
          `;
        }
        return;
      }

      const now = minutesNow();
      const secs = secondsNow();
      let html = "<table class='scheduleTable'><thead><tr><th>Period</th><th>Start</th><th>End</th></tr></thead><tbody>";
      let current = null;
      let next = null;
      
      clockDisplay.style.fontSize = ''; // v1.4 Reset font size override

      for (let i=0; i<today.length; i++) {
        const p = today[i];
        const active = now >= p.start && now < p.end;
        if (active) {
          current = p;
          next = today[i+1] || null;
        }
        html += `<tr class='${active?"highlight":""}'>
          <td>${p.name}</td>
          <td>${format(p.start)}</td>
          <td>${format(p.end)}</td>
        </tr>`;
      }

      html += "</tbody></table>";

      if (!current) {
        for (let i=0; i<today.length-1; i++) {
          if (now >= today[i].end && now < today[i+1].start) {
            current = { name: "Passing Period", start: today[i].end, end: today[i+1].start };
            next = today[i+1];
            break;
          }
        }
      }

      document.getElementById('schedule').innerHTML = html;

      if (current) {
        const remainingMinutes = current.end - now - 1;
        const remainingSeconds = 60 - secs;
        
        updateRollingText(clockDisplay, formatCountdown(remainingMinutes, remainingSeconds));
        document.getElementById('clockLabel').innerHTML = `TIME REMAINING - ${current.name}`;
        
        const nextName = next ? `${next.name}<br>${format(next.start)} - ${format(next.end)}` : "School Day Complete";
        document.getElementById('timer').innerHTML =
          `Current: <b>${current.name}</b><br>Next: ${nextName}`;
        document.getElementById('timer').classList.remove('hidden');
        
      } else {
        const firstPeriod = today[0];
        const lastPeriod = today[today.length - 1];
        
        if (now < firstPeriod.start) {
          const remainingMinutes = firstPeriod.start - now - 1;
          const remainingSeconds = 60 - secs;
          
          updateRollingText(clockDisplay, formatCountdown(remainingMinutes, remainingSeconds));
          document.getElementById('clockLabel').innerHTML = "UNTIL SCHOOL STARTS";
          document.getElementById('timer').innerHTML = 
            `Next: <b>${firstPeriod.name}</b><br>${format(firstPeriod.start)} - ${format(firstPeriod.end)}`;
          document.getElementById('timer').classList.remove('hidden');
          
        } else if (now >= lastPeriod.end) {
          const todayStr = new Date().toDateString();
          if (currentAfterSchoolMessage === null || lastMessageDay !== todayStr) {
            const homeworkMessages = [
              "Homework Time!",
              "Time to Study!",
              "Get Those Assignments Done!",
              "Focus on Your Schoolwork!",
              "Let's Finish That Homework!"
            ];
            currentAfterSchoolMessage = homeworkMessages[Math.floor(Math.random() * homeworkMessages.length)];
            lastMessageDay = todayStr;
          }
          updateRollingText(clockDisplay, currentAfterSchoolMessage);
          // v1.4 Make HW text responsive
          clockDisplay.style.fontSize = "clamp(2.0em, 8vw, 3.5em)";
          document.getElementById('clockLabel').innerHTML = "SCHOOL IS OVER";
          document.getElementById('timer').innerHTML = "See you tomorrow!";
          document.getElementById('timer').classList.remove('hidden');
          
        } else {
          updateRollingText(clockDisplay, "--:--:--");
          document.getElementById('clockLabel').innerHTML = "NO PERIOD SCHEDULED";
          document.getElementById('timer').classList.add('hidden');
        }
      }
    }

  </script>
</body>
</html>


